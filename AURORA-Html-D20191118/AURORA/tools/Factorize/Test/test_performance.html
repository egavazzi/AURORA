<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_performance</title>
  <meta name="keywords" content="test_performance">
  <meta name="description" content="TEST_PERFORMANCE compare performance of factorization/solve methods.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../../menu.html AURORA --><!-- ../../menu.html tools --><!-- ../menu.html Factorize --><!-- menu.html Test -->
<h1>test_performance
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>TEST_PERFORMANCE compare performance of factorization/solve methods.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function err = test_performance </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">TEST_PERFORMANCE compare performance of factorization/solve methods.
 Returns the largest relative residual seen.

 Example
   err = test_performance

 See also <a href="test_all.html" class="code" title="function test_all">test_all</a>, <a href="test_factorize.html" class="code" title="function err = test_factorize (A)">test_factorize</a>, factorize, inverse, mldivide</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a>	FACTORIZE an object-oriented method for solving linear systems</li><li><a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a>	</li><li><a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a>	INVERSE factorized representation of inv(A).</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="test_all.html" class="code" title="function test_all">test_all</a>	TEST_ALL test the Factorize package (factorize, factorize1, and inverse)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function err = test_performance</a>
0002 <span class="comment">%TEST_PERFORMANCE compare performance of factorization/solve methods.</span>
0003 <span class="comment">% Returns the largest relative residual seen.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Example</span>
0006 <span class="comment">%   err = test_performance</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% See also test_all, test_factorize, factorize, inverse, mldivide</span>
0009 
0010 <span class="comment">% Copyright 2009, Timothy A. Davis, University of Florida</span>
0011 
0012 fprintf (<span class="string">'\nPerformance comparisons of 5 methods:\n'</span>) ;
0013 fprintf (<span class="string">'    backslash: A\\b, or L\\b (and related) for solve times.\n'</span>) ;
0014 fprintf (<span class="string">'    linsolve:  a built-in MATLAB function\n'</span>) ;
0015 fprintf (<span class="string">'    factorize1:  the simple factorization object (uses LU)\n'</span>) ;
0016 fprintf (<span class="string">'    factorize:  the full-featured factorization object\n'</span>) ;
0017 fprintf (<span class="string">'    inv: x=inv(A)*b, the explicit inverse (ack!)\n'</span>) ;
0018 fprintf (<span class="string">'Run times are in seconds.\n'</span>) ;
0019 fprintf (<span class="string">'Times relative to best times are in parentheses.\n'</span>) ;
0020 
0021 <span class="comment">% linsolve options:</span>
0022 A_is_posdef.POSDEF = true ;     <span class="comment">% for x = A\b where A is sym. pos. definite</span>
0023 A_is_posdef.SYM = true ;
0024 lsolve.LT = true ;              <span class="comment">% for x = L\b where L is lower triangular</span>
0025 usolve.UT = true ;              <span class="comment">% for x = U\b where U is upper triangular</span>
0026 ltsolve.LT = true ;             <span class="comment">% for x = L'b where L is lower triangular</span>
0027 ltsolve.TRANSA = true ;
0028 
0029 nn = [50 100 500 1000] ;        <span class="comment">% matrix sizes to test</span>
0030 ns = length (nn) ;
0031 tmax = 1 ;                      <span class="comment">% minimum testing time</span>
0032 err = 0 ;                       <span class="comment">% largest relative residual seen</span>
0033 
0034 <span class="keyword">for</span> posdef = 0:1
0035 
0036     <span class="keyword">if</span> (posdef)
0037         fprintf (<span class="string">'\n------------------ For positive definite matrices:\n'</span>);
0038     <span class="keyword">else</span>
0039         fprintf (<span class="string">'\n------------------ For unsymmetric matrices:\n'</span>) ;
0040     <span class="keyword">end</span>
0041 
0042     Tfactor = zeros (ns,5) ;
0043     Tsolve  = zeros (ns,5) ;
0044 
0045     <span class="comment">%----------------------------------------------------------------------</span>
0046     <span class="comment">% compare factorizations times (plus a single solve)</span>
0047     <span class="comment">%----------------------------------------------------------------------</span>
0048 
0049     fprintf (<span class="string">'\nCompare factorization times:\n'</span>) ;
0050     <span class="keyword">for</span> i = 1:ns
0051         n = nn (i) ;
0052 
0053         fprintf (<span class="string">'n %4d '</span>, n) ;
0054 
0055         A = rand (n) ;
0056         <span class="keyword">if</span> (posdef)
0057             A = A'*A + eye (n) ;
0058         <span class="keyword">end</span>
0059         anorm = norm (A,1) ;
0060         b = rand (n,1) ;
0061 
0062         <span class="comment">% method 1: backslash</span>
0063         t = 0 ;
0064         k = 0 ;
0065         tic
0066         <span class="keyword">while</span> (t &lt; tmax)
0067             x = A\b ;
0068             k = k + 1 ;
0069             t = toc ;
0070         <span class="keyword">end</span>
0071         Tfactor (i,1) = t / k ;
0072         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0073         clear x
0074 
0075         <span class="keyword">if</span> (posdef)
0076 
0077             <span class="comment">% method 2: linsolve (pos. definite case)</span>
0078             t = 0 ;
0079             k = 0 ;
0080             tic
0081             <span class="keyword">while</span> (t &lt; tmax)
0082                 x = linsolve (A,b, A_is_posdef) ;
0083                 k = k + 1 ;
0084                 t = toc ;
0085             <span class="keyword">end</span>
0086             Tfactor (i,2) = t / k ;
0087             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0088             clear x
0089 
0090         <span class="keyword">else</span>
0091 
0092             <span class="comment">% method 2: linsolve (unsymmetric case)</span>
0093             t = 0 ;
0094             k = 0 ;
0095             tic
0096             <span class="keyword">while</span> (t &lt; tmax)
0097                 x = linsolve (A,b) ;
0098                 k = k + 1 ;
0099                 t = toc ;
0100             <span class="keyword">end</span>
0101             Tfactor (i,2) = t / k ;
0102             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0103             clear x
0104 
0105         <span class="keyword">end</span>
0106 
0107         <span class="comment">% method 3: factorize1 method</span>
0108         t = 0 ;
0109         k = 0 ;
0110         tic
0111         <span class="keyword">while</span> (t &lt; tmax)
0112             F = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0113             x = F\b ;
0114             k = k + 1 ;
0115             t = toc ;
0116         <span class="keyword">end</span>
0117         Tfactor (i,3) = t / k ;
0118         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0119         clear x F
0120 
0121         <span class="comment">% method 4: factorize method</span>
0122         t = 0 ;
0123         k = 0 ;
0124         tic
0125         <span class="keyword">while</span> (t &lt; tmax)
0126             F = <a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a> (A, posdef) ;
0127             x = F\b ;
0128             k = k + 1 ;
0129             t = toc ;
0130         <span class="keyword">end</span>
0131         Tfactor (i,4) = t / k ;
0132         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0133         clear x F
0134 
0135         <span class="comment">% method 5: inv method (ack!)</span>
0136         t = 0 ;
0137         k = 0 ;
0138         tic
0139         <span class="keyword">while</span> (t &lt; tmax)
0140             S = inv (A) ;
0141             x = S*b ;                                                  <span class="comment">%#ok</span>
0142             k = k + 1 ;
0143             t = toc ;
0144         <span class="keyword">end</span>
0145         Tfactor (i,5) = t / k ;
0146         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0147         clear x S
0148 
0149         tbest = min (Tfactor (i,:)) ;
0150         fprintf (<span class="string">'tbest %10.6f : backslash (%5.2f) '</span>, tbest, <span class="keyword">...</span>
0151             Tfactor (i,1) / tbest);
0152         fprintf (<span class="string">'linsolve (%5.2f) '</span>, Tfactor (i,2) / tbest) ;
0153         fprintf (<span class="string">'factorize1 (%5.2f) '</span>, Tfactor (i,3) / tbest) ;
0154         fprintf (<span class="string">'factorize (%5.2f) '</span>, Tfactor (i,4) / tbest) ;
0155         fprintf (<span class="string">'inv (%5.2f)\n'</span>,  Tfactor (i,5) / tbest) ;
0156 
0157     <span class="keyword">end</span>
0158 
0159     <span class="comment">%----------------------------------------------------------------------</span>
0160     <span class="comment">% compare solve times</span>
0161     <span class="comment">%----------------------------------------------------------------------</span>
0162 
0163     fprintf (<span class="string">'\nCompare solve times:\n'</span>) ;
0164     <span class="keyword">for</span> i = 1:ns
0165         n = nn (i) ;
0166 
0167         fprintf (<span class="string">'n %4d '</span>, n) ;
0168 
0169         A = rand (n) ;
0170         <span class="keyword">if</span> (posdef)
0171             A = A'*A + eye (n) ;
0172         <span class="keyword">end</span>
0173         b = rand (n,1) ;
0174         anorm = norm (A,1) ;
0175 
0176         <span class="keyword">if</span> (posdef)
0177             L = chol (A, <span class="string">'lower'</span>) ;
0178         <span class="keyword">else</span>
0179             [L,U,p] = lu (A,<span class="string">'vector'</span>) ;
0180         <span class="keyword">end</span>
0181 
0182         S = inv (A) ;
0183         F = <a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a>  (A) ;
0184         F1 = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0185 
0186         <span class="keyword">if</span> (posdef)
0187 
0188             <span class="comment">% method 1: backslash (pos. definite case)</span>
0189             t = 0 ;
0190             k = 0 ;
0191             tic
0192             <span class="keyword">while</span> (t &lt; tmax)
0193                 x = L' \ (L\b) ;
0194                 k = k + 1 ;
0195                 t = toc ;
0196             <span class="keyword">end</span>
0197             Tsolve (i,1) = t / k ;
0198             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0199             clear x
0200 
0201             <span class="comment">% method 2: linsolve (pos. definite case)</span>
0202             t = 0 ;
0203             k = 0 ;
0204             tic
0205             <span class="keyword">while</span> (t &lt; tmax)
0206                 x = linsolve (L, linsolve (L, b, lsolve), ltsolve) ;
0207                 k = k + 1 ;
0208                 t = toc ;
0209             <span class="keyword">end</span>
0210             Tsolve (i,2) = t / k ;
0211             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0212             clear x
0213 
0214         <span class="keyword">else</span>
0215 
0216             <span class="comment">% method 1: backslash (unsymmetric case)</span>
0217             t = 0 ;
0218             k = 0 ;
0219             tic
0220             <span class="keyword">while</span> (t &lt; tmax)
0221                 x = U \ (L \ (b (p))) ;
0222                 k = k + 1 ;
0223                 t = toc ;
0224             <span class="keyword">end</span>
0225             Tsolve (i,1) = t / k ;
0226             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0227             clear x
0228 
0229             <span class="comment">% method 2: linsolve (unsymmetric case)</span>
0230             t = 0 ;
0231             k = 0 ;
0232             tic
0233             <span class="keyword">while</span> (t &lt; tmax)
0234                 x = linsolve (U, linsolve (L, b (p), lsolve), usolve) ;
0235                 k = k + 1 ;
0236                 t = toc ;
0237             <span class="keyword">end</span>
0238             Tsolve (i,2) = t / k ;
0239             err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0240             clear x
0241 
0242         <span class="keyword">end</span>
0243 
0244         <span class="comment">% method 3: factorize1 object</span>
0245         t = 0 ;
0246         k = 0 ;
0247         tic
0248         <span class="keyword">while</span> (t &lt; tmax)
0249             x = F1\b ;
0250             k = k + 1 ;
0251             t = toc ;
0252         <span class="keyword">end</span>
0253         Tsolve (i,3) = t / k ;
0254         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0255         clear x
0256 
0257         <span class="comment">% method 4: factorize object</span>
0258         t = 0 ;
0259         k = 0 ;
0260         tic
0261         <span class="keyword">while</span> (t &lt; tmax)
0262             x = F\b ;
0263             k = k + 1 ;
0264             t = toc ;
0265         <span class="keyword">end</span>
0266         Tsolve (i,4) = t / k ;
0267         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0268         clear x
0269 
0270         <span class="comment">% method 5: &quot;inv&quot; method (ack!)</span>
0271         t = 0 ;
0272         k = 0 ;
0273         tic
0274         <span class="keyword">while</span> (t &lt; tmax)
0275             x = S*b ;           <span class="comment">%#ok</span>
0276             k = k + 1 ;
0277             t = toc ;
0278         <span class="keyword">end</span>
0279         Tsolve (i,5) = t / k ;
0280         err = max (err, norm (A*x-b,1) / (anorm + norm (x,1))) ;
0281         clear x
0282 
0283         tbest = min (Tsolve (i,:)) ;
0284         fprintf (<span class="string">'tbest %10.6f : backslash (%5.2f) '</span>, tbest, <span class="keyword">...</span>
0285             Tsolve (i,1) / tbest);
0286         fprintf (<span class="string">'linsolve (%5.2f) '</span>, Tsolve (i,2) / tbest) ;
0287         fprintf (<span class="string">'factorize1 (%5.2f) '</span>, Tsolve (i,3) / tbest) ;
0288         fprintf (<span class="string">'factorize (%5.2f) '</span>, Tsolve (i,4) / tbest) ;
0289         fprintf (<span class="string">'inv (%5.2f)\n'</span>,  Tsolve (i,5) / tbest) ;
0290 
0291         clear F F1 S L U p
0292 
0293     <span class="keyword">end</span>
0294 
0295     <span class="comment">% determine break-even values for inv</span>
0296     fprintf (<span class="string">'\nBreak-even values K for inv vs the other methods\n'</span>) ;
0297     fprintf (<span class="string">'(# of solves must exceed K for inv(A)*b to be faster):\n'</span>) ;
0298     <span class="keyword">for</span> i = 1:ns
0299         n = nn (i) ;
0300         s = zeros (4,1) ;
0301         <span class="keyword">for</span> t = 1:4
0302             <span class="keyword">if</span> (Tfactor (i,5) &gt; Tfactor (i,t) &amp;&amp; <span class="keyword">...</span>
0303                 Tsolve (i,5) &gt; Tsolve (i,t))
0304                 <span class="comment">% inv is always slower, for any K</span>
0305                 s (t) = inf ;
0306             <span class="keyword">elseif</span> (Tfactor (i,5) &lt; Tfactor (i,t) &amp;&amp; <span class="keyword">...</span>
0307                 Tsolve (i,5) &lt; Tsolve (i,t))
0308                 <span class="comment">% inv is always faster, for any K</span>
0309                 s (t) = 1 ;
0310             <span class="keyword">else</span>
0311                 s (t) = (Tfactor (i,5) - Tfactor (i,t)) / <span class="keyword">...</span>
0312                          (Tsolve (i,t) - Tsolve (i,5));
0313             <span class="keyword">end</span>
0314         <span class="keyword">end</span>
0315 
0316         fprintf (<span class="string">'n %4d  # solves vs backslash %8.1f'</span>, n, max (1, s (1))) ;
0317         fprintf (<span class="string">' vs linsolve: %8.1f  '</span>, max (1, s (2))) ;
0318         fprintf (<span class="string">' vs factorize1: %8.1f  '</span>, max (1, s (3))) ;
0319         fprintf (<span class="string">' vs factorize: %8.1f\n'</span>, max (1, s (4))) ;
0320     <span class="keyword">end</span>
0321 
0322 <span class="keyword">end</span>
0323 
0324 <span class="comment">%--------------------------------------------------------------------------</span>
0325 <span class="comment">% compute the Schur complement, S = A-B*inv(D)*C</span>
0326 <span class="comment">%--------------------------------------------------------------------------</span>
0327 
0328 fprintf (<span class="string">'\nSchur complement, S=A-B*inv(D)*C or A-B(D\\C),\n'</span>) ;
0329 fprintf (<span class="string">'where A, B, C, and D are square and unsymmetric.\n'</span>) ;
0330 fprintf (<span class="string">'&quot;inverse&quot; means S=A-B*inverse(D)*C, which does not actually\n'</span>) ;
0331 fprintf (<span class="string">'use the inverse, but uses the factorization object instead.\n'</span>) ;
0332 
0333 Tschur = zeros (ns,6) ;
0334 
0335 <span class="keyword">for</span> i = 1:ns
0336     n = nn (i) ;
0337     fprintf (<span class="string">'n %4d '</span>, n) ;
0338 
0339     A = rand (n) ;
0340     B = rand (n) ;
0341     C = rand (n) ;
0342     D = rand (n) ;
0343 
0344     <span class="comment">% method 1: backslash</span>
0345     t = 0 ;
0346     k = 0 ;
0347     tic
0348     <span class="keyword">while</span> (t &lt; tmax)
0349         S = A - B*(D\C) ;                                              <span class="comment">%#ok</span>
0350         k = k + 1 ;
0351         t = toc ;
0352     <span class="keyword">end</span>
0353     Tschur (i,1) = t / k ;
0354     clear S
0355 
0356     <span class="comment">% method 2: linsolve</span>
0357     t = 0 ;
0358     k = 0 ;
0359     tic
0360     <span class="keyword">while</span> (t &lt; tmax)
0361         S = A - B * linsolve (D,C) ;                                   <span class="comment">%#ok</span>
0362         k = k + 1 ;
0363         t = toc ;
0364     <span class="keyword">end</span>
0365     Tschur (i,2) = t / k ;
0366     clear S
0367 
0368     <span class="comment">% method 3: factorize1 object</span>
0369     t = 0 ;
0370     k = 0 ;
0371     tic
0372     <span class="keyword">while</span> (t &lt; tmax)
0373         S = A - B*(<a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a>(D)\C) ;                                  <span class="comment">%#ok</span>
0374         k = k + 1 ;
0375         t = toc ;
0376     <span class="keyword">end</span>
0377     Tschur (i,3) = t / k ;
0378     clear F S
0379 
0380     <span class="comment">% method 4: factorize object</span>
0381     t = 0 ;
0382     k = 0 ;
0383     tic
0384     <span class="keyword">while</span> (t &lt; tmax)
0385         S = A - B*(<a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a>(D)\C) ;                                   <span class="comment">%#ok</span>
0386         k = k + 1 ;
0387         t = toc ;
0388     <span class="keyword">end</span>
0389     Tschur (i,4) = t / k ;
0390     clear F S
0391 
0392     <span class="comment">% method 5:</span>
0393     t = 0 ;
0394     k = 0 ;
0395     tic
0396     <span class="keyword">while</span> (t &lt; tmax)
0397         S = A - B*<a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a>(D)*C ;                                       <span class="comment">%#ok</span>
0398         k = k + 1 ;
0399         t = toc ;
0400     <span class="keyword">end</span>
0401     Tschur (i,5) = t / k ;
0402     clear S
0403 
0404     <span class="comment">% method 6: &quot;inv&quot; method, using the explicit inverse (ack!)</span>
0405     t = 0 ;
0406     k = 0 ;
0407     tic
0408     <span class="keyword">while</span> (t &lt; tmax)
0409         S = A - B*inv(D)*C ;                                           <span class="comment">%#ok</span>
0410         k = k + 1 ;
0411         t = toc ;
0412     <span class="keyword">end</span>
0413     Tschur (i,6) = t / k ;
0414     clear S
0415 
0416     tbest = min (Tschur (i,:)) ;
0417     fprintf (<span class="string">'tbest %10.6f : backslash (%5.2f) '</span>, tbest, <span class="keyword">...</span>
0418         Tschur (i,1) / tbest);
0419     fprintf (<span class="string">'linsolve (%5.2f) '</span>, Tschur (i,2) / tbest) ;
0420     fprintf (<span class="string">'factorize1 (%5.2f) '</span>, Tschur (i,3) / tbest) ;
0421     fprintf (<span class="string">'factorize (%5.2f) '</span>, Tschur (i,4) / tbest) ;
0422     fprintf (<span class="string">'inverse (%5.2f) '</span>, Tschur (i,5) / tbest) ;
0423     fprintf (<span class="string">'inv (%5.2f)\n'</span>,  Tschur (i,6) / tbest) ;
0424 
0425 <span class="keyword">end</span>
0426</pre></div>
<hr><address>Generated on Mon 18-Nov-2019 14:53:30 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>