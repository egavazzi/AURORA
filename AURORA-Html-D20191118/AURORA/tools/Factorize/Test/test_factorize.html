<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_factorize</title>
  <meta name="keywords" content="test_factorize">
  <meta name="description" content="TEST_FACTORIZE test the accuracy of the factorization object">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../../menu.html AURORA --><!-- ../../menu.html tools --><!-- ../menu.html Factorize --><!-- menu.html Test -->
<h1>test_factorize
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>TEST_FACTORIZE test the accuracy of the factorization object</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function err = test_factorize (A) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">TEST_FACTORIZE test the accuracy of the factorization object

 Example
   test_factorize (A) ;    % where A is a square matrix (sparse or dense)

 See also <a href="test_all.html" class="code" title="function test_all">test_all</a>, factorize1, factorize, inverse, mldivide</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a>	FACTORIZE an object-oriented method for solving linear systems</li><li><a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a>	</li><li><a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a>	INVERSE factorized representation of inv(A).</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="test_accuracy.html" class="code" title="function err = test_accuracy">test_accuracy</a>	TEST_ACCURACY test the accuracy of the factorize object</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function err = check_resid (err, anorm, A, x, b, transposed)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function err = test_factorize (A)</a>
0002 <span class="comment">%TEST_FACTORIZE test the accuracy of the factorization object</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Example</span>
0005 <span class="comment">%   test_factorize (A) ;    % where A is a square matrix (sparse or dense)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% See also test_all, factorize1, factorize, inverse, mldivide</span>
0008 
0009 <span class="comment">% Copyright 2009, Timothy A. Davis, University of Florida</span>
0010 
0011 <span class="keyword">if</span> (nargin &lt; 1)
0012     A = rand (100) ;
0013 <span class="keyword">end</span>
0014 
0015 [m n] = size (A) ;
0016 err = 0 ;
0017 <span class="keyword">if</span> (min (m,n) &gt; 0)
0018     anorm = norm (A,1) ;
0019 <span class="keyword">else</span>
0020     anorm = 1 ;
0021 <span class="keyword">end</span>
0022 
0023 <span class="keyword">for</span> nrhs = 1:3
0024 
0025     <span class="keyword">for</span> bsparse = 0:1
0026 
0027         <span class="comment">% fprintf ('n %4d nrhs %d bsparse %d : ', n, nrhs, bsparse) ;</span>
0028 
0029         b = rand (m,nrhs) ;
0030         <span class="keyword">if</span> (bsparse)
0031             b = sparse (b) ;
0032         <span class="keyword">end</span>
0033 
0034         <span class="comment">%------------------------------------------------------------------</span>
0035         <span class="comment">% test backslash and related methods</span>
0036         <span class="comment">%------------------------------------------------------------------</span>
0037 
0038         <span class="comment">% method 0:</span>
0039         x = A\b ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0040 
0041         <span class="comment">% method 1:</span>
0042         S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (A) ;
0043         x = S*b ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0044 
0045         <span class="comment">% method 2:</span>
0046         <span class="keyword">if</span> (m == n)
0047             F = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0048             x = F\b ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0049         <span class="keyword">end</span>
0050 
0051         <span class="comment">% method 3:</span>
0052         <span class="keyword">if</span> (m == n)
0053             S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0054             x = S*b ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0055         <span class="keyword">end</span>
0056 
0057         <span class="comment">% method 4:</span>
0058         F = <a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a> (A) ;
0059         x = F\b ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0060 
0061         <span class="comment">% method 5:</span>
0062         S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0063         x = S*b ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0064 
0065         <span class="comment">% method 6:</span>
0066         <span class="keyword">if</span> (m == n)
0067             [L,U,p] = lu (A, <span class="string">'vector'</span>) ;
0068             x = U \ (L \ (b (p,:))) ;
0069             err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0070         <span class="keyword">end</span>
0071 
0072         <span class="comment">% method 7 (ack!)</span>
0073         <span class="keyword">if</span> (m == n)
0074             S = inv (A) ;
0075         <span class="keyword">else</span>
0076             S = pinv (full (A)) ;
0077             <span class="keyword">if</span> (issparse (A))
0078                 S = sparse (S) ;
0079             <span class="keyword">end</span>
0080         <span class="keyword">end</span>
0081         x = S*b ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0082 
0083         <span class="comment">%------------------------------------------------------------------</span>
0084         <span class="comment">% test mtimes</span>
0085         <span class="comment">%------------------------------------------------------------------</span>
0086 
0087         S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0088         d = rand (n,1) ;
0089         x = F*d ;
0090         y = A*d ;
0091         z = S\d ;
0092         e = max (norm (x-y,1), norm (x-z,1)) ;
0093         <span class="keyword">if</span> (e &gt; 0)
0094             error (<span class="string">'mtimes error'</span>) ;
0095         <span class="keyword">end</span>
0096 
0097         <span class="keyword">if</span> (m == n)
0098             F = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0099             S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0100             d = rand (n,1) ;
0101             x = F*d ;
0102             y = A*d ;
0103             z = S\d ;
0104             e = max (norm (x-y,1), norm (x-z,1)) ;
0105             <span class="keyword">if</span> (e &gt; 0)
0106                 error (<span class="string">'mtimes error'</span>) ;
0107             <span class="keyword">end</span>
0108         <span class="keyword">end</span>
0109 
0110         <span class="comment">%------------------------------------------------------------------</span>
0111         <span class="comment">% test slash and related methods</span>
0112         <span class="comment">%------------------------------------------------------------------</span>
0113 
0114         b = rand (nrhs,n) ;
0115         <span class="keyword">if</span> (bsparse)
0116             b = sparse (b) ;
0117         <span class="keyword">end</span>
0118 
0119         <span class="comment">% method 0:</span>
0120         x = b/A ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0121 
0122         <span class="comment">% method 1:</span>
0123         S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (A) ;
0124         x = b*S ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0125 
0126         <span class="comment">% method 2:</span>
0127         <span class="keyword">if</span> (m == n)
0128             F = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0129             x = b/F ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0130         <span class="keyword">end</span>
0131 
0132         <span class="comment">% method 3:</span>
0133         <span class="keyword">if</span> (m == n)
0134             S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0135             x = b*S ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0136         <span class="keyword">end</span>
0137 
0138         <span class="comment">% method 4:</span>
0139         F = <a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a> (A) ;
0140         x = b/F ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0141 
0142         <span class="comment">% method 5:</span>
0143         S = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0144         x = b*S ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0145 
0146         <span class="comment">% method 6:</span>
0147         <span class="keyword">if</span> (m == n)
0148             [L,U,p] = lu (A, <span class="string">'vector'</span>) ;
0149             x = (b / U) / L ; x (:,p) = x ;
0150             err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0151         <span class="keyword">end</span>
0152 
0153         <span class="comment">% method 7 (ack!)</span>
0154         <span class="keyword">if</span> (m == n)
0155             S = inv (A) ;
0156         <span class="keyword">else</span>
0157             S = pinv (full (A)) ;
0158             <span class="keyword">if</span> (issparse (A))
0159                 S = sparse (S) ;
0160             <span class="keyword">end</span>
0161         <span class="keyword">end</span>
0162         x = b*S ;           err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b, 1) ;
0163 
0164         <span class="comment">%------------------------------------------------------------------</span>
0165         <span class="comment">% test double</span>
0166         <span class="comment">%------------------------------------------------------------------</span>
0167 
0168         Y = double (<a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (A)) ;
0169         <span class="keyword">if</span> (m == n)
0170             Z = inv (A) ;
0171         <span class="keyword">else</span>
0172             Z = pinv (full (A)) ;
0173         <span class="keyword">end</span>
0174         e = norm (Y-Z,1) ;
0175         <span class="keyword">if</span> (n &gt; 0)
0176             e = e / norm (Z,1) ;
0177         <span class="keyword">end</span>
0178         err = max (e, err) ;
0179 
0180         <span class="comment">%------------------------------------------------------------------</span>
0181         <span class="comment">% test subsref</span>
0182         <span class="comment">%------------------------------------------------------------------</span>
0183 
0184         F = <a href="../../../../AURORA/tools/Factorize/factorize.html" class="code" title="function F = factorize (A,try_chol)">factorize</a> (A) ;
0185         Y = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (A) ;
0186         <span class="keyword">if</span> (numel (A) &gt; 1)
0187             <span class="keyword">if</span> (F (end) ~= A (end))
0188                 error (<span class="string">'factorization subsref error'</span>) ;
0189             <span class="keyword">end</span>
0190             <span class="keyword">if</span> (F.A (end) ~= A (end))
0191                 error (<span class="string">'factorization subsref error'</span>) ;
0192             <span class="keyword">end</span>
0193         <span class="keyword">end</span>
0194         <span class="keyword">if</span> (n &gt; 0)
0195             <span class="keyword">if</span> (F (1,1) ~= A (1,1))
0196                 error (<span class="string">'factorization subsref error'</span>) ;
0197             <span class="keyword">end</span>
0198             <span class="keyword">if</span> (F.A (1,1) ~= A (1,1))
0199                 error (<span class="string">'factorization subsref error'</span>) ;
0200             <span class="keyword">end</span>
0201             e = abs (Y (1,1) - Z (1,1)) ;
0202             err = max (e,err) ;
0203             <span class="keyword">if</span> (m &gt; 1 &amp;&amp; n &gt; 1)
0204                 e = norm (Y (1:2,1:2) - Z (1:2,1:2), 1) ;
0205                 err = max (e,err) ;
0206             <span class="keyword">end</span>
0207         <span class="keyword">end</span>
0208         <span class="keyword">if</span> (m &gt; 3 &amp;&amp; n &gt; 1)
0209             <span class="keyword">if</span> (any (F (2:<span class="keyword">end</span>, 1:2) - A (2:<span class="keyword">end</span>, 1:2)))
0210                 error (<span class="string">'factorization subsref error'</span>) ;
0211             <span class="keyword">end</span>
0212             <span class="keyword">if</span> (any (F (2:4, :) - A (2:4, :)))
0213                 error (<span class="string">'factorization subsref error'</span>) ;
0214             <span class="keyword">end</span>
0215             <span class="keyword">if</span> (any (F (:, 1:2) - A (:, 1:2)))
0216                 error (<span class="string">'factorization subsref error'</span>) ;
0217             <span class="keyword">end</span>
0218         <span class="keyword">end</span>
0219 
0220         <span class="comment">%------------------------------------------------------------------</span>
0221         <span class="comment">% test update/downdate</span>
0222         <span class="comment">%------------------------------------------------------------------</span>
0223 
0224         <span class="keyword">if</span> (isa (F, <span class="string">'factorization_dense_chol'</span>))
0225             w = rand (n,1) ;
0226             b = rand (n,1) ;
0227             <span class="comment">% update</span>
0228             G = F + w ;
0229             x = G\b ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A+w*w', x, b) ;
0230             <span class="comment">% downdate</span>
0231             G = G - w ;
0232             x = G\b ;       err = <a href="#_sub1" class="code" title="subfunction err = check_resid (err, anorm, A, x, b, transposed)">check_resid</a> (err, anorm, A, x, b) ;
0233             clear G
0234         <span class="keyword">end</span>
0235 
0236         <span class="comment">%------------------------------------------------------------------</span>
0237         <span class="comment">% test size</span>
0238         <span class="comment">%------------------------------------------------------------------</span>
0239 
0240         [m1 n1] = size (F) ;
0241         [m n] = size (A) ;
0242         <span class="keyword">if</span> (m1 ~= m || n1 ~= n)
0243             error (<span class="string">'size error'</span>) ;
0244         <span class="keyword">end</span>
0245         [m1 n1] = size (Y) ;
0246         <span class="keyword">if</span> (m1 ~= n || n1 ~= m)
0247             error (<span class="string">'pinv size error'</span>) ;
0248         <span class="keyword">end</span>
0249         <span class="keyword">if</span> (size (Y,1) ~= n || size (Y,2) ~= m)
0250             error (<span class="string">'pinv size error'</span>) ;
0251         <span class="keyword">end</span>
0252         <span class="keyword">if</span> (size (F,1) ~= m || size (F,2) ~= n)
0253             error (<span class="string">'size error'</span>) ;
0254         <span class="keyword">end</span>
0255 
0256         <span class="comment">%------------------------------------------------------------------</span>
0257         <span class="comment">% test mtimes</span>
0258         <span class="comment">%------------------------------------------------------------------</span>
0259 
0260         d = rand (1,m) ;
0261         x = d*F ;
0262         y = d*A ;
0263         z = d/Y ;
0264         e = max (norm (x-y,1), norm (x-z,1)) ;
0265         <span class="keyword">if</span> (e &gt; 0)
0266             error (<span class="string">'mtimes error'</span>) ;
0267         <span class="keyword">end</span>
0268 
0269         <span class="keyword">if</span> (m == n)
0270             F = <a href="../../../../AURORA/tools/Factorize/factorize1.html" class="code" title="">factorize1</a> (A) ;
0271             Y = <a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (F) ;
0272             d = rand (1,m) ;
0273             x = d*F ;
0274             y = d*A ;
0275             z = d/Y ;
0276             e = max (norm (x-y,1), norm (x-z,1)) ;
0277             <span class="keyword">if</span> (e &gt; 0)
0278                 error (<span class="string">'mtimes error'</span>) ;
0279             <span class="keyword">end</span>
0280         <span class="keyword">end</span>
0281 
0282         <span class="comment">%------------------------------------------------------------------</span>
0283         <span class="comment">% test inverse</span>
0284         <span class="comment">%------------------------------------------------------------------</span>
0285 
0286         Y = double (<a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (<a href="../../../../AURORA/tools/Factorize/inverse.html" class="code" title="function S = inverse (X)">inverse</a> (A))) ;
0287         e = norm (A-Y,1) ;
0288         <span class="keyword">if</span> (e &gt; 0)
0289             error (<span class="string">'inverse error'</span>) ;
0290         <span class="keyword">end</span>
0291 
0292     <span class="keyword">end</span>
0293 <span class="keyword">end</span>
0294 
0295 fprintf (<span class="string">'.'</span>) ;
0296 
0297 <span class="keyword">if</span> (err &gt; 1e-8)
0298     fprintf (<span class="string">'error: %8.3e\n'</span>, err) ;
0299     error (<span class="string">'error is too high!'</span>) ;
0300 <span class="keyword">end</span>
0301 
0302 <span class="comment">%--------------------------------------------------------------------------</span>
0303 
0304 <a name="_sub1" href="#_subfunctions" class="code">function err = check_resid (err, anorm, A, x, b, transposed)</a>
0305 <span class="keyword">if</span> (nargin &lt; 6)
0306     transposed = 0 ;
0307 <span class="keyword">end</span>
0308 [m n] = size (A) ;
0309 
0310 <span class="keyword">if</span> (transposed)
0311     <span class="keyword">if</span> (m &gt;= n)
0312         e = norm (A'*x'-b',1) / (anorm + norm (x,1)) ;
0313     <span class="keyword">else</span>
0314         e = norm (A*(A'*x')-A*b',1) / (anorm + norm (x,1)) ;
0315     <span class="keyword">end</span>
0316 <span class="keyword">else</span>
0317     <span class="keyword">if</span> (m &lt;= n)
0318         e = norm (A*x-b,1) / (anorm + norm (x,1)) ;
0319     <span class="keyword">else</span>
0320         e = norm (A'*(A*x)-A'*b,1) / (anorm + norm (x,1)) ;
0321     <span class="keyword">end</span>
0322 <span class="keyword">end</span>
0323 
0324 <span class="keyword">if</span> (min (m,n) &gt; 1)
0325     <span class="keyword">if</span> (issparse (A) &amp;&amp; issparse (b))
0326         <span class="keyword">if</span> (~issparse (x))
0327             error (<span class="string">'x must be sparse'</span>) ;
0328         <span class="keyword">end</span>
0329     <span class="keyword">else</span>
0330         <span class="keyword">if</span> (issparse (x))
0331             error (<span class="string">'x must be full'</span>) ;
0332         <span class="keyword">end</span>
0333     <span class="keyword">end</span>
0334 <span class="keyword">end</span>
0335 err = max (err, e) ;
0336</pre></div>
<hr><address>Generated on Mon 18-Nov-2019 14:53:30 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>