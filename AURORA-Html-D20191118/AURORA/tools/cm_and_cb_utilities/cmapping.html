<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cmapping</title>
  <meta name="keywords" content="cmapping">
  <meta name="description" content="CMAPPING   Colormap linear mapping/interpolation.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html AURORA --><!-- ../menu.html tools --><!-- menu.html cm_and_cb_utilities -->
<h1>cmapping
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>CMAPPING   Colormap linear mapping/interpolation.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function RGB = cmapping(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">CMAPPING   Colormap linear mapping/interpolation.

   SYNTAX:
           cmapping
           cmapping(U)
           cmapping(U,CMAP)
           cmapping(U,CMAP,...,CNAN)
           cmapping(U,CMAP,...,TYPE)
           cmapping(U,CMAP,...,MODE)
           cmapping(U,CMAP,...,MAPS)
           cmapping(U,CMAP,...,CLIM)
           cmapping(AX,...)
     RGB = cmapping(...);

   INPUT:
     U     - May be one of the following options:
              a) An scalar specifying the output M number of colors.
              b) A vector of length M specifying the values at which
                 the function CMAP(IMAP) will be mapped.
              c) A matrix of size M-by-N specifying intensities to be
                 mapped to an RGB (3-dim) image. May have NaNs elements. 
             DEFAULT: Current colormap length.
     CMAP  - A COLORMAP defined by its name or handle-function or RGB
             matrix (with 3 columns) or by a combination of colors chars
             specifiers ('kbcw', for example) to be mapped. See NOTE below
             for more options.
             DEFAULT: Current colormap
     CNAN  - Color for NaNs values on U, specified by a 1-by-3 RGB color
             or a char specifier.
             DEFAULT: Current axes background (white color: [1 1 1])
     TYPE  - String specifying the result type. One of:
               'colormap'  Forces a RGB colormap matrix result (3 columns)
               'image'     Forces a RGB image result (3 dimensions)
             DEFAULT: 'image' if U is a matrix, otherwise is 'colormap'
     MODE  - Defines the mapping way. One of:
               'discrete'     For discrete colors
               'continuous'   For continuous color (interpolates)
             DEFAULT: 'continuous' (interpolates between colors)
     MAPS  - Specifies the mapping type. One of (see NOTES below):
               'scaled'   Scales mapping, also by using CLIM (as IMAGESC).
               'direct'   Do not scales the mapping (as IMAGE).
             DEFAULT: 'scaled' (uses CLIM)
     CLIM  - Two element vector that, if given, scales the mapping within
             this color limits. Ignored if 'direct' is specified.
             DEFAULT: [0 size(CMAP,1)] or [0 1].
     AX    - Uses specified axes or figure handle to set/get the colormap.
             If used, must be the first input.
             DEFAULT: gca

   OUTPUT (all optional):
     RGB - If U is not a matrix, this is an M-by-3 colormap matrix with
           RGB colors in its rows, otherwise is an RGB image: M-by-N-by-3,
           with the color red intensities defined by RGB(:,:,1), the green
           ones by RGB(:,:,2) and the blue ones by RGB(:,:,3).

   DESCRIPTION:
     This functions has various functionalities like: colormap generator,
     colormap expansion/contraction, color mapping/interpolation, matrix
     intensities convertion to RGB image, etc.

     The basic idea is a linear mapping between the CMAP columns
     [red green blue] and the U data, ignoring its NaNs.

   NOTE:
     * Optional inputs use its DEFAULT value when not given or [].
     * Optional outputs may or not be called.
     * If a single value of U is required for interpolation, use [U U].
     * If the char '-' is used before the CMAP name, the colors will be
       flipped. The same occurs if U is a negative integer.

   EXAMPLE:
     % Colormaps:
       figure, cmapping( 256,'krgby')            , colorbar
       figure, cmapping(-256,'krgby' ,'discrete'), colorbar
       figure, cmapping(log(1:100),[],'discrete'), colorbar
     % Images:
       u = random('chi2',2,20,30); u(15:16,7:9) = NaN;
       u = peaks(30);  u(15:16,7:9) = NaN;
       v = cmapping(u,jet(64),'discrete','k');
       w = cmapping(u,cmapping(log(0:63),'jet','discrete'),'discrete');
       figure, imagesc(u), cmapping(64,'jet'), colorbar
        title('u')
       figure, imagesc(v), cmapping(64,'jet'), colorbar
        title('u transformed to RGB (look the colored NaNs)')
       figure, imagesc(w) ,cmapping(64,'jet'), colorbar
        title('u mapped with log(colormap)')
       figure, imagesc(u), cmapping(log(0:63),'jet','discrete'), colorbar
        title('u with log(colormap)')
    
   SEE ALSO:
     COLORMAP, IND2RGB
     and
     <a href="cmjoin.html" class="code" title="function [CMAP,LEV,WID,CLIM] = cmjoin(varargin)">CMJOIN</a> by Carlos Vargas
     at http://www.mathworks.com/matlabcentral/fileexchange


   ---
   MFILE:   <a href="cmapping.html" class="code" title="function RGB = cmapping(varargin)">cmapping</a>.m
   VERSION: 1.1 (Sep 02, 2009) (&lt;a href=&quot;matlab:web('http://www.mathworks.com/matlabcentral/fileexchange/authors/11258')&quot;&gt;download&lt;/a&gt;)
   MATLAB:  7.7.0.471 (R2008b)
   AUTHOR:  Carlos Adrian Vargas Aguilera (MEXICO)
   CONTACT: nubeobscura@hotmail.com</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="cmfit.html" class="code" title="function [CMAP,CLIM,WIDTH,REF,LEVELS] = cmfit(CMAP,CLIM,WIDTH,REF,CENTER,varargin)">cmfit</a>	CMFIT   Sets the COLORMAP and CAXIS to specific color bands.</li><li><a href="cmjoin.html" class="code" title="function [CMAP,LEV,WID,CLIM] = cmjoin(varargin)">cmjoin</a>	CMJOIN   Joins colormaps at certain levels.</li><li><a href="cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>	CMLINES   Change the color of plotted lines using the colormap.</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function RGB = cmapping(varargin)</a>
0002 <span class="comment">%CMAPPING   Colormap linear mapping/interpolation.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   SYNTAX:</span>
0005 <span class="comment">%           cmapping</span>
0006 <span class="comment">%           cmapping(U)</span>
0007 <span class="comment">%           cmapping(U,CMAP)</span>
0008 <span class="comment">%           cmapping(U,CMAP,...,CNAN)</span>
0009 <span class="comment">%           cmapping(U,CMAP,...,TYPE)</span>
0010 <span class="comment">%           cmapping(U,CMAP,...,MODE)</span>
0011 <span class="comment">%           cmapping(U,CMAP,...,MAPS)</span>
0012 <span class="comment">%           cmapping(U,CMAP,...,CLIM)</span>
0013 <span class="comment">%           cmapping(AX,...)</span>
0014 <span class="comment">%     RGB = cmapping(...);</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   INPUT:</span>
0017 <span class="comment">%     U     - May be one of the following options:</span>
0018 <span class="comment">%              a) An scalar specifying the output M number of colors.</span>
0019 <span class="comment">%              b) A vector of length M specifying the values at which</span>
0020 <span class="comment">%                 the function CMAP(IMAP) will be mapped.</span>
0021 <span class="comment">%              c) A matrix of size M-by-N specifying intensities to be</span>
0022 <span class="comment">%                 mapped to an RGB (3-dim) image. May have NaNs elements.</span>
0023 <span class="comment">%             DEFAULT: Current colormap length.</span>
0024 <span class="comment">%     CMAP  - A COLORMAP defined by its name or handle-function or RGB</span>
0025 <span class="comment">%             matrix (with 3 columns) or by a combination of colors chars</span>
0026 <span class="comment">%             specifiers ('kbcw', for example) to be mapped. See NOTE below</span>
0027 <span class="comment">%             for more options.</span>
0028 <span class="comment">%             DEFAULT: Current colormap</span>
0029 <span class="comment">%     CNAN  - Color for NaNs values on U, specified by a 1-by-3 RGB color</span>
0030 <span class="comment">%             or a char specifier.</span>
0031 <span class="comment">%             DEFAULT: Current axes background (white color: [1 1 1])</span>
0032 <span class="comment">%     TYPE  - String specifying the result type. One of:</span>
0033 <span class="comment">%               'colormap'  Forces a RGB colormap matrix result (3 columns)</span>
0034 <span class="comment">%               'image'     Forces a RGB image result (3 dimensions)</span>
0035 <span class="comment">%             DEFAULT: 'image' if U is a matrix, otherwise is 'colormap'</span>
0036 <span class="comment">%     MODE  - Defines the mapping way. One of:</span>
0037 <span class="comment">%               'discrete'     For discrete colors</span>
0038 <span class="comment">%               'continuous'   For continuous color (interpolates)</span>
0039 <span class="comment">%             DEFAULT: 'continuous' (interpolates between colors)</span>
0040 <span class="comment">%     MAPS  - Specifies the mapping type. One of (see NOTES below):</span>
0041 <span class="comment">%               'scaled'   Scales mapping, also by using CLIM (as IMAGESC).</span>
0042 <span class="comment">%               'direct'   Do not scales the mapping (as IMAGE).</span>
0043 <span class="comment">%             DEFAULT: 'scaled' (uses CLIM)</span>
0044 <span class="comment">%     CLIM  - Two element vector that, if given, scales the mapping within</span>
0045 <span class="comment">%             this color limits. Ignored if 'direct' is specified.</span>
0046 <span class="comment">%             DEFAULT: [0 size(CMAP,1)] or [0 1].</span>
0047 <span class="comment">%     AX    - Uses specified axes or figure handle to set/get the colormap.</span>
0048 <span class="comment">%             If used, must be the first input.</span>
0049 <span class="comment">%             DEFAULT: gca</span>
0050 <span class="comment">%</span>
0051 <span class="comment">%   OUTPUT (all optional):</span>
0052 <span class="comment">%     RGB - If U is not a matrix, this is an M-by-3 colormap matrix with</span>
0053 <span class="comment">%           RGB colors in its rows, otherwise is an RGB image: M-by-N-by-3,</span>
0054 <span class="comment">%           with the color red intensities defined by RGB(:,:,1), the green</span>
0055 <span class="comment">%           ones by RGB(:,:,2) and the blue ones by RGB(:,:,3).</span>
0056 <span class="comment">%</span>
0057 <span class="comment">%   DESCRIPTION:</span>
0058 <span class="comment">%     This functions has various functionalities like: colormap generator,</span>
0059 <span class="comment">%     colormap expansion/contraction, color mapping/interpolation, matrix</span>
0060 <span class="comment">%     intensities convertion to RGB image, etc.</span>
0061 <span class="comment">%</span>
0062 <span class="comment">%     The basic idea is a linear mapping between the CMAP columns</span>
0063 <span class="comment">%     [red green blue] and the U data, ignoring its NaNs.</span>
0064 <span class="comment">%</span>
0065 <span class="comment">%   NOTE:</span>
0066 <span class="comment">%     * Optional inputs use its DEFAULT value when not given or [].</span>
0067 <span class="comment">%     * Optional outputs may or not be called.</span>
0068 <span class="comment">%     * If a single value of U is required for interpolation, use [U U].</span>
0069 <span class="comment">%     * If the char '-' is used before the CMAP name, the colors will be</span>
0070 <span class="comment">%       flipped. The same occurs if U is a negative integer.</span>
0071 <span class="comment">%</span>
0072 <span class="comment">%   EXAMPLE:</span>
0073 <span class="comment">%     % Colormaps:</span>
0074 <span class="comment">%       figure, cmapping( 256,'krgby')            , colorbar</span>
0075 <span class="comment">%       figure, cmapping(-256,'krgby' ,'discrete'), colorbar</span>
0076 <span class="comment">%       figure, cmapping(log(1:100),[],'discrete'), colorbar</span>
0077 <span class="comment">%     % Images:</span>
0078 <span class="comment">%       u = random('chi2',2,20,30); u(15:16,7:9) = NaN;</span>
0079 <span class="comment">%       u = peaks(30);  u(15:16,7:9) = NaN;</span>
0080 <span class="comment">%       v = cmapping(u,jet(64),'discrete','k');</span>
0081 <span class="comment">%       w = cmapping(u,cmapping(log(0:63),'jet','discrete'),'discrete');</span>
0082 <span class="comment">%       figure, imagesc(u), cmapping(64,'jet'), colorbar</span>
0083 <span class="comment">%        title('u')</span>
0084 <span class="comment">%       figure, imagesc(v), cmapping(64,'jet'), colorbar</span>
0085 <span class="comment">%        title('u transformed to RGB (look the colored NaNs)')</span>
0086 <span class="comment">%       figure, imagesc(w) ,cmapping(64,'jet'), colorbar</span>
0087 <span class="comment">%        title('u mapped with log(colormap)')</span>
0088 <span class="comment">%       figure, imagesc(u), cmapping(log(0:63),'jet','discrete'), colorbar</span>
0089 <span class="comment">%        title('u with log(colormap)')</span>
0090 <span class="comment">%</span>
0091 <span class="comment">%   SEE ALSO:</span>
0092 <span class="comment">%     COLORMAP, IND2RGB</span>
0093 <span class="comment">%     and</span>
0094 <span class="comment">%     CMJOIN by Carlos Vargas</span>
0095 <span class="comment">%     at http://www.mathworks.com/matlabcentral/fileexchange</span>
0096 <span class="comment">%</span>
0097 <span class="comment">%</span>
0098 <span class="comment">%   ---</span>
0099 <span class="comment">%   MFILE:   cmapping.m</span>
0100 <span class="comment">%   VERSION: 1.1 (Sep 02, 2009) (&lt;a href=&quot;matlab:web('http://www.mathworks.com/matlabcentral/fileexchange/authors/11258')&quot;&gt;download&lt;/a&gt;)</span>
0101 <span class="comment">%   MATLAB:  7.7.0.471 (R2008b)</span>
0102 <span class="comment">%   AUTHOR:  Carlos Adrian Vargas Aguilera (MEXICO)</span>
0103 <span class="comment">%   CONTACT: nubeobscura@hotmail.com</span>
0104 
0105 <span class="comment">%   REVISIONS:</span>
0106 <span class="comment">%   1.0      Released. (Jun 08, 2009)</span>
0107 <span class="comment">%   1.0.1    Fixed little bug with 'm' magenta color. (Jun 30, 2009)</span>
0108 <span class="comment">%   1.1      Fixed BUG with empty CMAP, thanks to Andrea Rumazza. (Sep 02,</span>
0109 <span class="comment">%            2009)</span>
0110 
0111 <span class="comment">%   DISCLAIMER:</span>
0112 <span class="comment">%   cmapping.m is provided &quot;as is&quot; without warranty of any kind, under the</span>
0113 <span class="comment">%   revised BSD license.</span>
0114 
0115 <span class="comment">%   Copyright (c) 2009 Carlos Adrian Vargas Aguilera</span>
0116 
0117 
0118 <span class="comment">% INPUTS CHECK-IN</span>
0119 <span class="comment">% -------------------------------------------------------------------------</span>
0120 
0121 <span class="comment">% Sets defaults:</span>
0122 AX     = {};                     <span class="comment">% Calculated inside.</span>
0123 U      = [];                     <span class="comment">% Calculated inside.</span>
0124 CMAP   = [];                     <span class="comment">% Calculated inside.</span>
0125 TYPE   = <span class="string">'colormap'</span>;             <span class="comment">% Changes to 'image' if U is a matrix.</span>
0126 CLIM   = [];                     <span class="comment">% To use in scaling</span>
0127 CNAN   = [1 1 1];                <span class="comment">% White 'w'</span>
0128 MODE   = <span class="string">'continuous'</span>;           <span class="comment">% Scaling to CLIM</span>
0129 MAPS   = <span class="string">'scaled'</span>;               <span class="comment">% Scaled mapping</span>
0130 method = <span class="string">'linear'</span>;               <span class="comment">% Interpolation method</span>
0131 mflip  = false;                  <span class="comment">% Flip the colormap</span>
0132 
0133 <span class="comment">% Gets figure handle and axes handle (just in case the default colormap or</span>
0134 <span class="comment">% background color axes will be used.</span>
0135 HF     = get(0,<span class="string">'CurrentFigure'</span>);
0136 HA     = [];
0137 <span class="keyword">if</span> ~isempty(HF)
0138  HA    = get(HF,<span class="string">'CurrentAxes'</span>);
0139  <span class="keyword">if</span> ~isempty(HA)
0140   CNAN = get(HA,<span class="string">'Color'</span>);        <span class="comment">% NaNs colors</span>
0141  <span class="keyword">end</span>
0142 <span class="keyword">end</span>
0143 
0144 <span class="comment">% Checks inputs:</span>
0145 <span class="keyword">if</span> nargin&gt;8
0146  error(<span class="string">'CVARGAS:cmapping:tooManyInputs'</span>, <span class="keyword">...</span>
0147   <span class="string">'At most 8 inputs are allowed.'</span>)
0148 <span class="keyword">elseif</span> nargout&gt;1
0149  error(<span class="string">'CVARGAS:cmapping:tooManyOutputs'</span>, <span class="keyword">...</span>
0150   <span class="string">'At most 1 output is allowed.'</span>)
0151 <span class="keyword">end</span>
0152 
0153 <span class="comment">% Checks AX:</span>
0154 <span class="keyword">if</span> (~isempty(varargin)) &amp;&amp; ~isempty(varargin{1}) &amp;&amp; <span class="keyword">...</span>
0155   (numel(varargin{1})==1) &amp;&amp; ishandle(varargin{1}) &amp;&amp; <span class="keyword">...</span>
0156   strcmp(get(varargin{1},<span class="string">'Type'</span>),<span class="string">'axes'</span>)
0157  <span class="comment">% Gets AX and moves all other inputs to the left:</span>
0158  AX          = varargin(1);
0159  HA          = AX{1};
0160  CNAN        = get(HA,<span class="string">'Color'</span>);
0161  varargin(1) = [];
0162 <span class="keyword">end</span>
0163 
0164 <span class="comment">% Checks U:</span>
0165 Nargin = length(varargin);
0166 <span class="keyword">if</span> ~isempty(varargin)
0167  U           = varargin{1};
0168  varargin(1) = [];
0169 <span class="keyword">end</span>
0170 
0171 <span class="comment">% Checks CMAP:</span>
0172 <span class="keyword">if</span> ~isempty(varargin)
0173  CMAP        = varargin{1};
0174  varargin(1) = []; 
0175 <span class="keyword">end</span>
0176 
0177 <span class="comment">% Checks input U, if not given uses as default colormap length:</span>
0178 <span class="comment">% Note: it is not converted to a vector in case CMAP is a function and IMAP</span>
0179 <span class="comment">%       was not given.</span>
0180 <span class="keyword">if</span> isempty(U)
0181  <span class="comment">% Gets default COLORMAP length:</span>
0182  <span class="keyword">if</span> ~isempty(HA)
0183   U = size(colormap(HA),1);
0184  <span class="keyword">else</span>
0185   U = size(get(0,<span class="string">'DefaultFigureColormap'</span>),1);
0186  <span class="keyword">end</span>
0187 <span class="keyword">elseif</span> ndims(U)&gt;2
0188  error(<span class="string">'CVARGAS:cmapping:incorrectXInput'</span>, <span class="keyword">...</span>
0189   <span class="string">'U must be an scalar, a vector or a 2-dimensional matrix.'</span>)
0190 <span class="keyword">end</span>
0191 
0192 <span class="comment">% Checks input CMAP:</span>
0193 <span class="keyword">if</span> isempty(CMAP)
0194  <span class="comment">% CMAP empty, then uses default:</span>
0195  <span class="keyword">if</span> ~isempty(HA)
0196   CMAP = colormap(HA);
0197   <span class="keyword">if</span> isempty(CMAP) <span class="comment">% Fixed BUG, Sep 2009.</span>
0198    CMAP = get(0,<span class="string">'DefaultFigureColormap'</span>);
0199    <span class="keyword">if</span> isempty(CMAP)
0200     CMAP = jet(64);
0201    <span class="keyword">end</span>
0202   <span class="keyword">end</span>
0203  <span class="keyword">else</span>
0204   CMAP = get(0,<span class="string">'DefaultFigureColormap'</span>);
0205   <span class="keyword">if</span> isempty(CMAP)
0206    CMAP = jet(64);
0207   <span class="keyword">end</span>
0208  <span class="keyword">end</span>
0209  Ncmap = size(CMAP,1);
0210 <span class="keyword">elseif</span> isnumeric(CMAP)
0211  <span class="comment">% CMAP as an [R G B] colormap:</span>
0212  Ncmap = size(CMAP,1);
0213  <span class="keyword">if</span> (size(CMAP,2)~=3) || <span class="keyword">...</span>
0214   ((min(CMAP(:))&lt;0) || (max(CMAP(:))&gt;1)) || any(~isfinite(CMAP(:)))
0215   error(<span class="string">'CVARGAS:cmapping:incorrectCmapInput'</span>, <span class="keyword">...</span>
0216         <span class="string">'CMAP is an incorrect 3 columns RGB colors.'</span>)
0217  <span class="keyword">end</span>
0218 <span class="keyword">elseif</span> ischar(CMAP)
0219  <span class="comment">% String CMAP</span>
0220  <span class="comment">% Checks first character:</span>
0221  <span class="keyword">switch</span> CMAP(1)
0222   <span class="keyword">case</span> <span class="string">'-'</span>
0223    mflip = ~mflip;
0224    CMAP(1) = [];
0225    <span class="keyword">if</span> isempty(CMAP)
0226     error(<span class="string">'CVARGAS:cmapping:emptyCmapInput'</span>,<span class="keyword">...</span>
0227      <span class="string">'CMAP function is empty.'</span>)
0228    <span class="keyword">end</span>
0229  <span class="keyword">end</span>
0230  <span class="keyword">if</span> ~((exist(CMAP,<span class="string">'file'</span>)==2) || (exist(CMAP,<span class="string">'builtin'</span>)==5))
0231   <span class="comment">% CMAP as a combination of color char specifiers:</span>
0232   CMAP  = lower(CMAP);
0233   iy    = (CMAP==<span class="string">'y'</span>);
0234   im    = (CMAP==<span class="string">'m'</span>);
0235   ic    = (CMAP==<span class="string">'c'</span>);
0236   ir    = (CMAP==<span class="string">'r'</span>);
0237   ig    = (CMAP==<span class="string">'g'</span>);
0238   ib    = (CMAP==<span class="string">'b'</span>);
0239   iw    = (CMAP==<span class="string">'w'</span>);
0240   ik    = (CMAP==<span class="string">'k'</span>);
0241   Ncmap = length(CMAP);
0242   <span class="keyword">if</span> (sum([iy im ic ir ig ib iw ik])~=Ncmap)
0243    error(<span class="string">'CVARGAS:cmapping:incorrectCmapStringInput'</span>, <span class="keyword">...</span>
0244    [<span class="string">'String CMAP must be a valid colormap name or a combination of '</span><span class="keyword">...</span>
0245     <span class="string">'''ymcrgbwk''.'</span>])
0246   <span class="keyword">end</span>
0247   <span class="comment">% Convertion to [R G B]:</span>
0248   CMAP       = zeros(Ncmap,3);
0249   CMAP(iy,:) = repmat([1 1 0],sum(iy),1);
0250   CMAP(im,:) = repmat([1 0 1],sum(im),1); <span class="comment">% BUG fixed Jun 2009</span>
0251   CMAP(ic,:) = repmat([0 1 1],sum(ic),1);
0252   CMAP(ir,:) = repmat([1 0 0],sum(ir),1);
0253   CMAP(ig,:) = repmat([0 1 0],sum(ig),1);
0254   CMAP(ib,:) = repmat([0 0 1],sum(ib),1);
0255   CMAP(iw,:) = repmat([1 1 1],sum(iw),1);
0256   CMAP(ik,:) = repmat([0 0 0],sum(ik),1);
0257  <span class="keyword">else</span>
0258   <span class="comment">% CMAP as a function name</span>
0259   <span class="comment">% Changes function name to handle:</span>
0260   CMAP = str2func(CMAP);
0261   Ncmap = []; <span class="comment">% This indicates a CMAP function input</span>
0262  <span class="keyword">end</span>
0263 <span class="keyword">elseif</span> isa(CMAP,<span class="string">'function_handle'</span>)
0264  Ncmap = []; <span class="comment">% This indicates a CMAP function input</span>
0265 <span class="keyword">else</span>
0266  <span class="comment">% CMAP input unrecognized:</span>
0267  error(<span class="string">'CVARGAS:cmapping:incorrectCmapInput'</span>, <span class="keyword">...</span>
0268   <span class="string">'Not recognized CMAP input.'</span>) 
0269 <span class="keyword">end</span>
0270 
0271 <span class="comment">% Checks CMAP function handle:</span>
0272 <span class="keyword">if</span> isempty(Ncmap)
0273  <span class="comment">% Generates the COLORMAP from function:</span>
0274  <span class="keyword">try</span>
0275   temp = CMAP(2);
0276   <span class="keyword">if</span> ~all(size(temp)==[2 3]) || any(~isfinite(temp(:))), error(<span class="string">''</span>), <span class="keyword">end</span>
0277   clear temp
0278  <span class="keyword">catch</span>
0279   error(<span class="string">'CVARGAS:cmapping:incorrectCmapFunction'</span>, <span class="keyword">...</span>
0280    [<span class="string">'CMAP function '''</span> func2str(CMAP) <span class="string">''' must result in RGB colors.'</span>])
0281  <span class="keyword">end</span>
0282 <span class="keyword">end</span>
0283 
0284 <span class="comment">% Checks varargin:</span>
0285 <span class="keyword">while</span> ~isempty(varargin)
0286  <span class="keyword">if</span>     isempty(varargin{1})
0287   <span class="comment">% continue</span>
0288  <span class="keyword">elseif</span> ischar(varargin{1})
0289   <span class="comment">% string input</span>
0290   <span class="keyword">switch</span> lower(varargin{1})
0291    <span class="comment">% CNAN:</span>
0292    <span class="keyword">case</span> <span class="string">'y'</span>         , CNAN = [1 1 0];
0293    <span class="keyword">case</span> <span class="string">'m'</span>         , CNAN = [1 0 0];
0294    <span class="keyword">case</span> <span class="string">'c'</span>         , CNAN = [0 1 1];
0295    <span class="keyword">case</span> <span class="string">'r'</span>         , CNAN = [1 0 0];
0296    <span class="keyword">case</span> <span class="string">'g'</span>         , CNAN = [0 1 0];
0297    <span class="keyword">case</span> <span class="string">'b'</span>         , CNAN = [0 0 1];
0298    <span class="keyword">case</span> <span class="string">'w'</span>         , CNAN = [1 1 1];
0299    <span class="keyword">case</span> <span class="string">'k'</span>         , CNAN = [0 0 0];
0300    <span class="comment">% MODE:</span>
0301    <span class="keyword">case</span> <span class="string">'discrete'</span>  , MODE = <span class="string">'discrete'</span>;
0302    <span class="keyword">case</span> <span class="string">'continuous'</span>, MODE = <span class="string">'continuous'</span>;
0303    <span class="comment">% TYPE:</span>
0304    <span class="keyword">case</span> <span class="string">'colormap'</span>  , TYPE = <span class="string">'colormap'</span>;
0305    <span class="keyword">case</span> <span class="string">'image'</span>     , TYPE = <span class="string">'image'</span>;
0306    <span class="comment">% MAPS:</span>
0307    <span class="keyword">case</span> <span class="string">'direct'</span>    , MAPS = <span class="string">'direct'</span>;
0308    <span class="keyword">case</span> <span class="string">'scaled'</span>    , MAPS = <span class="string">'scaled'</span>;
0309    <span class="comment">% Incorrect input:</span>
0310    <span class="keyword">otherwise</span>
0311     error(<span class="string">'CVARGAS:cmapping:incorrectStringInput'</span>,<span class="keyword">...</span>
0312      [<span class="string">'Not recognized optional string input: '''</span> varargin{1} <span class="string">'''.'</span>])
0313   <span class="keyword">end</span>
0314  <span class="keyword">elseif</span> isnumeric(varargin{1}) &amp;&amp; all(isfinite(varargin{1}(:)))
0315   <span class="comment">% numeric input</span>
0316   nv = numel(varargin{1});
0317   <span class="keyword">if</span> (nv==3) &amp;&amp; (size(varargin{1},1)==1)
0318    <span class="comment">% CNAN:</span>
0319    CNAN = varargin{1}(:)';
0320    <span class="keyword">if</span> (max(CNAN)&gt;1) || (min(CNAN)&lt;0)
0321     error(<span class="string">'CVARGAS:cmapping:incorrectCnanInput'</span>,<span class="keyword">...</span>
0322      <span class="string">'CNAN elements must be between 0 and 1.'</span>)
0323    <span class="keyword">end</span>
0324   <span class="keyword">elseif</span> (nv==2) &amp;&amp; (size(varargin{1},1)==1)
0325    <span class="comment">% CLIM:</span>
0326    CLIM = sort(varargin{1},<span class="string">'ascend'</span>);
0327    <span class="keyword">if</span> (diff(CLIM)==0)
0328     error(<span class="string">'CVARGAS:cmapping:incorrectClimValues'</span>,<span class="keyword">...</span>
0329      <span class="string">'CLIM must have 2 distint elements.'</span>)
0330    <span class="keyword">end</span>
0331   <span class="keyword">else</span>
0332    error(<span class="string">'CVARGAS:cmapping:incorrectNumericInput'</span>,<span class="keyword">...</span>
0333    <span class="string">'Not recognized numeric input.'</span>)
0334   <span class="keyword">end</span>
0335  <span class="keyword">else</span>
0336   error(<span class="string">'CVARGAS:cmapping:incorrectInput'</span>,<span class="keyword">...</span>
0337    <span class="string">'Not recognized input.'</span>)
0338  <span class="keyword">end</span>
0339  <span class="comment">% Clears current optional input:</span>
0340  varargin(1) = [];
0341 <span class="keyword">end</span> <span class="comment">% while</span>
0342 
0343 
0344 <span class="comment">% -------------------------------------------------------------------------</span>
0345 <span class="comment">% MAIN</span>
0346 <span class="comment">% -------------------------------------------------------------------------</span>
0347 
0348 <span class="comment">% U size:</span>
0349 [m,n] = size(U);
0350 mn    = m*n;
0351 
0352 <span class="comment">% Checks TYPE:</span>
0353 <span class="keyword">if</span> ~any([m n]==1)
0354  <span class="comment">% Forces image TYPE if U is a matrix:</span>
0355  TYPE = <span class="string">'image'</span>;
0356 <span class="keyword">elseif</span> strcmp(TYPE,<span class="string">'colormap'</span>) &amp;&amp; ~nargout &amp;&amp; isempty(AX)
0357  <span class="comment">% Changes the colormap on the specified or current axes if no output</span>
0358  <span class="comment">% argument:</span>
0359  AX = {gca};
0360 <span class="keyword">end</span>
0361 
0362 <span class="comment">% Forces positive integer if U is an scalar, and flips CMAP if is negative:</span>
0363 <span class="keyword">if</span> (mn==1)
0364  U = round(U);
0365  <span class="keyword">if</span> (U==0)
0366   <span class="keyword">if</span> ~nargout &amp;&amp; strcmp(TYPE,<span class="string">'colormap'</span>)
0367    warning(<span class="string">'CVARGAS:cmapping:incorrectUInput'</span>,<span class="keyword">...</span>
0368     <span class="string">'U was zero and produces no colormap'</span>)
0369   <span class="keyword">else</span>
0370    RGB = [];
0371   <span class="keyword">end</span>
0372   <span class="keyword">return</span>
0373  <span class="keyword">elseif</span> (U&lt;0)
0374   mflip = ~mflip;
0375   U     = abs(U);
0376  <span class="keyword">end</span>
0377 <span class="keyword">end</span>
0378 
0379 <span class="comment">% Gets CMAP from function handle:</span>
0380 <span class="keyword">if</span> isempty(Ncmap)
0381  <span class="keyword">if</span> (mn==1)
0382   <span class="comment">% From U:</span>
0383   Ncmap = U(1);
0384  <span class="keyword">else</span>
0385   <span class="comment">% From default colormap:</span>
0386   <span class="keyword">if</span> ~isempty(HA)
0387    Ncmap = size(colormap(HA),1);
0388   <span class="keyword">else</span>
0389    Ncmap = size(get(0,<span class="string">'DefaultFigureColormap'</span>),1);
0390   <span class="keyword">end</span>
0391  <span class="keyword">end</span>
0392  CMAP = CMAP(Ncmap);
0393 <span class="keyword">end</span>
0394 
0395 <span class="comment">% Flips the colormap</span>
0396 <span class="keyword">if</span> mflip
0397  CMAP = flipud(CMAP);
0398 <span class="keyword">end</span>
0399 
0400 <span class="comment">% Check CMAP when U is an scalar::</span>
0401 <span class="keyword">if</span> (mn==1) &amp;&amp; (U==Ncmap)
0402  <span class="comment">% Finishes:</span>
0403  <span class="keyword">if</span> ~nargout &amp;&amp; strcmp(TYPE,<span class="string">'colormap'</span>)
0404   <span class="keyword">if</span> Nargin==0
0405    RGB = colormap(AX{:},CMAP);
0406   <span class="keyword">else</span>
0407    colormap(AX{:},CMAP)
0408   <span class="keyword">end</span>
0409  <span class="keyword">else</span>
0410   RGB = CMAP;
0411   <span class="keyword">if</span> strcmp(TYPE,<span class="string">'image'</span>)
0412    RGB = reshape(RGB,Ncmap,1,3);
0413   <span class="keyword">end</span>
0414  <span class="keyword">end</span>
0415  <span class="keyword">return</span>
0416 <span class="keyword">end</span>
0417 
0418 <span class="comment">% Sets scales:</span>
0419 <span class="keyword">if</span> strcmp(MAPS,<span class="string">'scaled'</span>)
0420  <span class="comment">% Scaled mapping:</span>
0421  <span class="keyword">if</span> ~isempty(CLIM)
0422   <span class="keyword">if</span> (mn==1)
0423    mn = U;
0424    U = linspace(CLIM(1),CLIM(2),mn)';
0425   <span class="keyword">else</span>
0426    <span class="comment">% Continue</span>
0427   <span class="keyword">end</span>
0428  <span class="keyword">else</span>
0429   CLIM = [0 1];
0430   <span class="keyword">if</span> (mn==1)
0431    mn = U;
0432    U = linspace(CLIM(1),CLIM(2),mn)';
0433   <span class="keyword">else</span>
0434    <span class="comment">% Scales U to [0 1]:</span>
0435    U = U-min(U(isfinite(U(:))));
0436    U = U/max(U(isfinite(U(:))));
0437    <span class="comment">% Scales U to CLIM:</span>
0438    U = U*diff(CLIM)+CLIM(1);
0439   <span class="keyword">end</span>
0440  <span class="keyword">end</span>
0441 <span class="keyword">else</span>
0442  <span class="comment">% Direct mapping:</span>
0443  CLIM = [1 Ncmap];
0444 <span class="keyword">end</span>
0445 
0446 <span class="comment">% Do not extrapolates:</span>
0447 U(U&lt;CLIM(1)) = CLIM(1);
0448 U(U&gt;CLIM(2)) = CLIM(2);
0449 
0450 <span class="comment">% Sets CMAP argument:</span>
0451 umap = linspace(CLIM(1),CLIM(2),Ncmap)';
0452 
0453 <span class="comment">% Sets U:</span>
0454 <span class="keyword">if</span> (mn==2) &amp;&amp; (U(1)==U(2))
0455  <span class="comment">% U = [Uo Uo] implicates U = Uo:</span>
0456  U(2) = [];
0457  mn   = 1;
0458  m    = 1;
0459  n    = 1;
0460 <span class="keyword">end</span>
0461 
0462 <span class="comment">% Sets discretization:</span>
0463 <span class="keyword">if</span> strcmp(MODE,<span class="string">'discrete'</span>)
0464  umap2 = linspace(umap(1),umap(end),Ncmap+1)';
0465  <span class="keyword">for</span> k = 1:Ncmap
0466   U((U&gt;umap2(k)) &amp; (U&lt;=umap2(k+1))) = umap(k);
0467  <span class="keyword">end</span>
0468  clear umap2
0469 <span class="keyword">end</span>
0470 
0471 <span class="comment">% Forces column vector:</span>
0472 U = U(:);
0473 
0474 <span class="comment">% Gets finite data:</span>
0475 inan = ~isfinite(U);
0476 
0477 <span class="comment">% Initializes:</span>
0478 RGB  = repmat(reshape(CNAN,[1 1 3]),[mn 1 1]);
0479 
0480 <span class="comment">% Interpolates:</span>
0481 <span class="keyword">if</span> (Ncmap&gt;1) &amp;&amp; (sum(~inan)&gt;1)
0482  [Utemp,a,b]    = unique(U(~inan));
0483  RGBtemp = [<span class="keyword">...</span>
0484   interp1(umap,CMAP(:,1),Utemp,method) <span class="keyword">...</span>
0485   interp1(umap,CMAP(:,2),Utemp,method) <span class="keyword">...</span>
0486   interp1(umap,CMAP(:,3),Utemp,method) <span class="keyword">...</span>
0487   ];
0488  RGB(~inan,:) = RGBtemp(b,:);
0489 <span class="keyword">else</span>
0490  <span class="comment">% single color:</span>
0491  RGB(~inan,1,:) = repmat(reshape(CMAP,[1 1 3]),[sum(~inan) 1 1]);
0492 <span class="keyword">end</span>
0493 
0494 <span class="comment">% Just in case</span>
0495 RGB(RGB&gt;1) = 1; 
0496 RGB(RGB&lt;0) = 0;
0497 
0498 <span class="comment">% OUTPUTS CHECK-OUT</span>
0499 <span class="comment">% -------------------------------------------------------------------------</span>
0500 
0501 <span class="comment">% Output type:</span>
0502 <span class="keyword">if</span> strcmp(TYPE,<span class="string">'colormap'</span>)
0503  RGB = reshape(RGB,mn,3);
0504  <span class="keyword">if</span> ~isempty(AX)
0505   colormap(AX{:},RGB)
0506   <span class="keyword">if</span> ~nargout 
0507    clear RGB
0508   <span class="keyword">end</span>
0509  <span class="keyword">end</span>
0510 <span class="keyword">else</span>
0511  RGB = reshape(RGB,[m n 3]);
0512 <span class="keyword">end</span>
0513 
0514 
0515 <span class="comment">% [EOF]   cmapping.m</span></pre></div>
<hr><address>Generated on Mon 18-Nov-2019 14:53:30 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>