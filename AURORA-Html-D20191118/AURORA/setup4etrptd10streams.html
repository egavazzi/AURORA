<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of setup4etrptd10streams</title>
  <meta name="keywords" content="setup4etrptd10streams">
  <meta name="description" content="% Set-up script for Examples in time-dependent electron transport">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- menu.html AURORA -->
<h1>setup4etrptd10streams
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% Set-up script for Examples in time-dependent electron transport</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Set-up script for Examples in time-dependent electron transport</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../AURORA/Data_electron/N2_e_2nd_dist.html" class="code" title="function Xs = N2_e_2nd_dist(Es,E0in,Eionization,s_or_c)">N2_e_2nd_dist</a>	N2_e_2nd_dist - 2nd:ary electron energy spectra ionisation of N2.</li><li><a href="../AURORA/Data_electron/O2_e_2nd_dist.html" class="code" title="function Xs = O2_e_2nd_dist(Es,E0in,Eionization,s_or_c)">O2_e_2nd_dist</a>	O2_e_2nd_dist - 2nd:ary electron energy spectra ionisation of O2.</li><li><a href="../AURORA/Data_electron/O_e_2nd_dist.html" class="code" title="function Xs = O_e_2nd_dist(Es,E0in,Eionization,s_or_c)">O_e_2nd_dist</a>	O_e_2nd_dist - 2nd:ary electron energy spectra for ionisation of O.</li><li><a href="../AURORA/e_transport_Ms/e_scattering_beamdistribution.html" class="code" title="function [Pmu2mup,theta2beamW,BeamW] = e_scattering_beamdistribution(mu_lims,n_dirs)">e_scattering_beamdistribution</a>	e_scattering_beamdistribution - angular redistribution PDF for</li><li><a href="../AURORA/e_transport_Ms/mu_avg.html" class="code" title="function c_o_mu = mu_avg(mu_lims)">mu_avg</a>	MU_AVG - pitch-angle averages between limits of cosine-of-pitch-angles</li><li><a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>	BACKUP1000FILESVERSIONS - Backup files to prevent overwriting them</li><li><a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>	CMLINES   Change the color of plotted lines using the colormap.</li><li><a href="../AURORA/tools/colorbar_labeled.html" class="code" title="function handle=colorbar_labeled(label,lg,varargin)">colorbar_labeled</a>	COLORBAR_LABELED - colorbar with label for range linear or log</li><li><a href="../AURORA/tools/gridLegend.html" class="code" title="function legend_h = gridLegend(hdl,gd,varargin)">gridLegend</a>	gridLegend : plots a legend in a multi column format</li><li><a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>	Colormap from MatPlotLib 2.0. Perceptually uniform and very attractive!</li><li><a href="../AURORA/tools/legendflex.html" class="code" title="function varargout = legendflex(varargin)">legendflex</a>	LEGENDFLEX Creates a more flexible legend</li><li><a href="../AURORA/tools/py_D_cmap.html" class="code" title="function cm_data = py_D_cmap(n)">py_D_cmap</a>	py_D_cmap Shades of green and yellow colormap</li><li><a href="../AURORA/utilities/get_all_xs.html" class="code" title="function [Xs,xs_fcn] = get_all_xs(name,E)">get_all_xs</a>	GET_ALL_XS - collect all electron-neutral impact cross sections</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../AURORA/sup-scripts/Loop_finalRun_PnL_flickering10beams.html" class="code" title="">Loop_finalRun_PnL_flickering10beams</a>	% Batch-processing-script for FAB-flickering aurora</li><li><a href="../AURORA/sup-scripts/Loop_first_example_AURORA.html" class="code" title="">Loop_first_example_AURORA</a>	% Example-script for using AURORA the time-dependent electron-transport code</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Set-up script for Examples in time-dependent electron transport</span>
0002 
0003 <span class="comment">%% Figure-generation</span>
0004 plot_figs = 1;
0005 print_figs = 0;
0006 <span class="keyword">if</span> print_figs
0007   mkdir(<span class="string">'Figures'</span>)
0008 <span class="keyword">end</span>
0009 
0010 <span class="comment">%% Loading atmosphere model</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% The electron transport needs the density profiles of the major</span>
0013 <span class="comment">% thermospheric constituents, to model the collisions (ellastic and in-</span>
0014 <span class="comment">% ellastc) excitations and ionizations. Here we use the MSIS-00 atmosphere</span>
0015 <span class="comment">% for the date:</span>
0016 load msis20051008_3.dat
0017 
0018 h_atm = (74:1:610)'*1e3;h_atm = (100:1:610)'*1e3;
0019 dz = @(n) 150 + 150/200*(0:(n-1))' +1.2*exp(((0:(n-1))-150)/17)';
0020 z_atm = 100e3 + cumsum(dz(321)) - dz(1);
0021 numel(z_atm)/numel(h_atm);
0022 h_atm = z_atm(:); <span class="comment">% make sure it's a column vector</span>
0023 
0024 OPS.atmosphere = interp1(msis20051008_3(:,1),msis20051008_3,h_atm/1e3,<span class="string">'pchip'</span>);
0025 OPS.atmosphere(:,2:4) = OPS.atmosphere(:,2:4)*1e6; <span class="comment">% into m^-3</span>
0026 OPS.atmosphere(:,5) = OPS.atmosphere(:,5)*1e3;     <span class="comment">% into kg/m^-3</span>
0027 <span class="comment">% Below is an attempt to make a gradual transition from the dilute</span>
0028 <span class="comment">% uppermost thermosphere to mathematical vacuum, this might be useful to</span>
0029 <span class="comment">% ensure that the gradient of the upward fluxes automatically becomes</span>
0030 <span class="comment">% mathematically zero at the top to be in agreement with the mathematical</span>
0031 <span class="comment">% boundary condition for the upward fluxes. This is one possible cause of</span>
0032 <span class="comment">% peculiar numerical behaviour of the solution</span>
0033 nO = OPS.atmosphere(:,2);
0034 nN2 = OPS.atmosphere(:,3);
0035 nO2 = OPS.atmosphere(:,4);
0036 nO(end-2:end)  = 0;
0037 nO2(end-2:end) = 0;
0038 nN2(end-2:end) = 0;
0039 <span class="comment">%nO(end-7:end-3)  = (erf((2:-1:-2)'/2)+1)/2.*nO(end-7:end-3);</span>
0040 <span class="comment">%nO2(end-7:end-3) = (erf((2:-1:-2)'/2)+1)/2.*nO2(end-7:end-3);</span>
0041 <span class="comment">%nN2(end-7:end-3) = (erf((2:-1:-2)'/2)+1)/2.*nN2(end-7:end-3);</span>
0042 nO(end-5:end-3)  = (erf((1:-1:-1)'/2)+1)/2.*nO(end-5:end-3);
0043 nO2(end-5:end-3) = (erf((1:-1:-1)'/2)+1)/2.*nO2(end-5:end-3);
0044 nN2(end-5:end-3) = (erf((1:-1:-1)'/2)+1)/2.*nN2(end-5:end-3);
0045 
0046 <span class="comment">%%</span>
0047 <span class="comment">% Plot the atmosphere</span>
0048 <span class="keyword">if</span> plot_figs
0049   figure_atm = figure;
0050   subplot(1,2,1)
0051   phMSIS = semilogx([nN2,nO2,nO],h_atm/1e3,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2);
0052   axis([1e12 1e20 85 620])
0053   ylabel(<span class="string">'height (km)'</span>)
0054   xlabel(<span class="string">'[m^{-3}]'</span>)
0055   title(<span class="string">'MSIS neutral density'</span>)
0056   legend(phMSIS,<span class="string">'N_2'</span>,<span class="string">'O_2'</span>,<span class="string">'O'</span>)
0057   set(phMSIS(2),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0058   set(phMSIS(3),<span class="string">'linestyle'</span>,<span class="string">'-.'</span>)
0059 <span class="keyword">end</span>
0060 <span class="comment">%% 1.5 Load n_e(z) as estimated from EISCAT observations</span>
0061 <span class="comment">%  In addition to N_2, O_2 and O we need an electron density profile, to</span>
0062 <span class="comment">%  account for the energy degradation of primary electrons caused by the</span>
0063 <span class="comment">%  accumulated effect of millions of very weak Coulomb collisions, ideally</span>
0064 <span class="comment">%  ne(z) should be gotten from ISR-data, but for testing this is OK</span>
0065 load iri20051008.dat
0066 Iri20051008 = iri20051008(1:<span class="keyword">end</span>,:);
0067 ne = interp1(Iri20051008(:,1),Iri20051008(:,2),h_atm/1e3,<span class="string">'pchip'</span>)*10;
0068 ne(h_atm&lt;82e3) = 1;
0069 <span class="comment">%% Plot electron density profile</span>
0070 <span class="keyword">if</span> plot_figs
0071   figure(figure_atm)
0072   subplot(1,2,2)
0073   semilogx(ne,h_atm/1e3,<span class="string">'linewidth'</span>,2)
0074   title(<span class="string">'electron density'</span>)
0075   xlabel(<span class="string">'[m^{-3}]'</span>)
0076   axis([1e8 1e13 85 520])
0077   set(gca,<span class="string">'xtick'</span>,10.^(6:15))
0078   <span class="keyword">if</span> print_figs
0079     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'MSIS-IRI-atm-01.eps'</span>);
0080     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0081     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0082   <span class="keyword">end</span>
0083 <span class="keyword">end</span>
0084 <span class="comment">% Te = IRI!</span>
0085 Te = interp1(Iri20051008(:,1),Iri20051008(:,6),h_atm/1e3,<span class="string">'pchip'</span>);
0086 Te(Te==-1) = 350;
0087 
0088 
0089 <span class="comment">%% Magnetic inclination</span>
0090 mag_ze = 13*pi/180; <span class="comment">% This is the approximate magnetic inclination at EISCAT</span>
0091 
0092 <span class="comment">%% Excitation thresholds</span>
0093 <span class="comment">% And finally we load the energy levels of the excited states of</span>
0094 <span class="comment">% the major neutral species, this is obviously necessary to model the</span>
0095 <span class="comment">% energy-losses in inellastic collisions leading to excitation of discrete</span>
0096 <span class="comment">% levels.</span>
0097 load N2_levels.dat
0098 load O2_levels.dat
0099 load O_levels.dat
0100 <span class="comment">% Plot energy levels</span>
0101 <span class="keyword">if</span> plot_figs
0102   figure
0103   subplot(1,3,1)
0104   plot([0 1],O_levels(:,1)*[1 1],<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2)
0105   axis([0 1 0 25])
0106   set(gca,<span class="string">'xtick'</span>,[])
0107   ylabel(<span class="string">'Excitation energy (eV)'</span>)
0108   title(<span class="string">'O'</span>)
0109   subplot(1,3,2)
0110   plot([0 1],O2_levels(:,1)*[1 1],<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2)
0111   axis([0 1 0 25])
0112   set(gca,<span class="string">'xtick'</span>,[])
0113   title(<span class="string">'O_2'</span>)
0114   subplot(1,3,3)
0115   plot([0 1],N2_levels(:,1)*[1 1],<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2)
0116   axis([0 1 0 25])
0117   set(gca,<span class="string">'xtick'</span>,[])
0118   title(<span class="string">'N_2'</span>)
0119   <span class="keyword">if</span> print_figs
0120     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'ON2O2-Energy-levels-01.eps'</span>);
0121     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0122     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0123     <span class="comment">% print('-depsc2','-painters','ON2O2-Energy-levels-01.eps')</span>
0124   <span class="keyword">end</span>
0125 <span class="keyword">end</span>
0126 <span class="comment">%% Energy grids</span>
0127 <span class="comment">% For the transport-functions t work properly it seems as if the</span>
0128 <span class="comment">% energy-grid should not have bins wider than the lowest ionization</span>
0129 <span class="comment">% threshold.</span>
0130 <span class="comment">%</span>
0131 <span class="comment">% This energy-grid below work well.</span>
0132 dEfcn = @(X,DEinitial,DEfinal,C,X0) DEinitial+(1+tanh(C*(X-X0)))/2*DEfinal;
0133 E = cumsum(dEfcn(0:937,0.15,11.5,0.05,80))+1.9;
0134 E = E(1:stepE:end);
0135 dE = diff(E);dE = [dE,dE(end)];
0136 <span class="keyword">if</span> plot_figs
0137   figure
0138   plot(E,dE,<span class="string">'r.-'</span>)
0139   xlabel(<span class="string">'energy [eV]'</span>)
0140   ylabel(<span class="string">'energy [eV]'</span>)
0141   title(<span class="string">'Energy variation of energy bin size'</span>)
0142   <span class="keyword">if</span> print_figs
0143     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'Energy-grid-01.eps'</span>);
0144     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0145     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0146     <span class="comment">% print('-depsc2','-painters','Energy-grid-01.eps')</span>
0147   <span class="keyword">end</span>
0148 <span class="keyword">end</span>
0149 <span class="comment">%% Collision cross sections</span>
0150 <span class="comment">%  These collision cross-sections are taken from a series of</span>
0151 <span class="comment">%  compilation-papers by Itikawa and colleagues, from there the</span>
0152 <span class="comment">%  cross-sections have been digitized. (Itikawa et al. 1986 (N2), Itikawa</span>
0153 <span class="comment">%  and Ichimura 1990 (O), and Itikawa et al 1989 (O2))</span>
0154 [XsO,xs_fcnO] =   <a href="../AURORA/utilities/get_all_xs.html" class="code" title="function [Xs,xs_fcn] = get_all_xs(name,E)">get_all_xs</a>(<span class="string">'O'</span>,E+dE/2);
0155 [XsO2,xs_fcnO2] = <a href="../AURORA/utilities/get_all_xs.html" class="code" title="function [Xs,xs_fcn] = get_all_xs(name,E)">get_all_xs</a>(<span class="string">'O2'</span>,E+dE/2);
0156 [XsN2,xs_fcnN2] = <a href="../AURORA/utilities/get_all_xs.html" class="code" title="function [Xs,xs_fcn] = get_all_xs(name,E)">get_all_xs</a>(<span class="string">'N2'</span>,E+dE/2);
0157 <span class="comment">% %% Back-scattering-ratios</span>
0158 <span class="comment">% %  For two-stream calculations the angular part of the scattering is simply</span>
0159 <span class="comment">% %  an energy-dependent fraction of electron that escapes a collision in the</span>
0160 <span class="comment">% %  opposite hemispherical direction after a collision. These ratios are</span>
0161 <span class="comment">% %  taken from Solomon et al. 1988</span>
0162 <span class="comment">%</span>
0163 <span class="comment">% bscrO = back_scattering_42stream('O',E+dE/2);</span>
0164 <span class="comment">% bscrO2 = back_scattering_42stream('O2',E+dE/2);</span>
0165 <span class="comment">% bscrN2 = back_scattering_42stream('N2',E+dE/2);</span>
0166 <span class="comment">%% Name/-/label of excited levels.</span>
0167 fid = fopen(<span class="string">'N2_levels.name'</span>,<span class="string">'r'</span>);
0168 qwe = textscan(fid,<span class="string">'%s'</span>);
0169 fclose(fid);
0170 iN = 1;
0171 <span class="keyword">for</span> i1 = 1:numel(qwe{1})
0172   <span class="keyword">if</span> qwe{1}{i1}(1) ~= <span class="string">'%'</span>
0173     N2names{iN} = qwe{1}{i1};
0174     iN = iN+1;
0175   <span class="keyword">end</span>
0176 <span class="keyword">end</span>
0177 <span class="comment">% N2names = qwe{1};</span>
0178 fid = fopen(<span class="string">'O2_levels.name'</span>,<span class="string">'r'</span>);
0179 qwe = textscan(fid,<span class="string">'%s'</span>);
0180 fclose(fid);
0181 iN = 1;
0182 <span class="keyword">for</span> i1 = 1:numel(qwe{1})
0183   <span class="keyword">if</span> qwe{1}{i1}(1) ~= <span class="string">'%'</span>
0184     O2names{iN} = qwe{1}{i1};
0185     iN = iN+1;
0186   <span class="keyword">end</span>
0187 <span class="keyword">end</span>
0188 <span class="comment">%O2names = qwe{1};</span>
0189 fid = fopen(<span class="string">'O_levels.name'</span>,<span class="string">'r'</span>);
0190 qwe = textscan(fid,<span class="string">'%s'</span>);
0191 fclose(fid);
0192 iN = 1;
0193 <span class="keyword">for</span> i1 = 1:numel(qwe{1})
0194   <span class="keyword">if</span> qwe{1}{i1}(1) ~= <span class="string">'%'</span>
0195     Onames{iN} = qwe{1}{i1};
0196     iN = iN+1;
0197   <span class="keyword">end</span>
0198 <span class="keyword">end</span>
0199 <span class="comment">% Onames = qwe{1};</span>
0200 
0201 <span class="comment">%% Plot cross-sections and back-scattering ratios.</span>
0202 <span class="comment">%  For illustration and illumination, note that at energies larger than a</span>
0203 <span class="comment">%  few 10s of eV the ionization-cross-section dominates over the other</span>
0204 <span class="comment">%  in-ellastic cross-sections</span>
0205 <span class="keyword">if</span> plot_figs
0206   figure(<span class="string">'position'</span>,[306, 415, 1746, 559])
0207   subplot(1,3,1)
0208   phO = loglog(E,XsO,<span class="string">'linewidth'</span>,2);
0209   axis([E(1) E(end) 1e-25 1e-18])
0210   axis([2.0539 8000 1e-24 3e-19])
0211   set(phO(1),<span class="string">'color'</span>,<span class="string">'k'</span>)
0212   set(phO(2:7),<span class="string">'linestyle'</span>,<span class="string">'-'</span>)
0213   colormap(jet(64))
0214   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO(2:7))
0215   set(phO(8:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0216   cmpC = <a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>(64);
0217   colormap(cmpC(1:60,:))
0218   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO(8:end))
0219   <span class="comment">% legend(phO,Onames) % TODO: strrep fine_%d1_%d2 with fine(%d1-%d2)</span>
0220   <span class="keyword">for</span> i1 = numel(phO):-1:1
0221     Onames4l{i1} = sprintf(<span class="string">'%d'</span>,i1);
0222   <span class="keyword">end</span>
0223   legend(phO,Onames4l) <span class="comment">% TODO: strrep fine_%d1_%d2 with fine(%d1-%d2)</span>
0224   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0225   title(<span class="string">'\sigma O'</span>,<span class="string">'fontsize'</span>,16)
0226   ylabel(<span class="string">'[m^{-2}]'</span>,<span class="string">'fontsize'</span>,16)
0227   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,16)
0228   set(gca,<span class="string">'fontsize'</span>,14)
0229   
0230   subplot(1,3,2)
0231   phN2 = loglog(E,XsN2,<span class="string">'linewidth'</span>,2);
0232   axis([E(1) E(end) 1e-25 1e-18])
0233   axis([2.0539 8000 1e-24 3e-19])
0234   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2)
0235   set(phN2(2:3:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0236   set(phN2(3:3:end),<span class="string">'linestyle'</span>,<span class="string">'-.'</span>)
0237   set(phN2(end),<span class="string">'color'</span>,<span class="string">'k'</span>)
0238   <span class="keyword">for</span> i1 = numel(phN2):-1:1
0239     N2names4l{i1} = sprintf(<span class="string">'%d'</span>,i1);
0240   <span class="keyword">end</span>
0241   <span class="comment">%legend(phN2,N2names4l)</span>
0242   <span class="comment">% legend(phN2,N2names)</span>
0243   set(phN2(1),<span class="string">'color'</span>,<span class="string">'k'</span>)
0244   set(phN2(2:12),<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,1) 
0245   <span class="comment">% colormap(summer)</span>
0246   colormap(<a href="../AURORA/tools/py_D_cmap.html" class="code" title="function cm_data = py_D_cmap(n)">py_D_cmap</a>)
0247   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(2:12))     
0248   set(phN2(end-5:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)         
0249   set(phN2(13:end-6),<span class="string">'linestyle'</span>,<span class="string">'-'</span>)  
0250   cmpC = <a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>(64);
0251   colormap(cmpC(1:60,:))
0252   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(end-5:end))
0253   colormap(jet(64))
0254   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(13:end-6)) 
0255   title(<span class="string">'\sigma N_2'</span>,<span class="string">'fontsize'</span>,16)
0256   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0257   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,16)
0258   <span class="comment">%legHdl = gridLegend(phN2,2,N2names4l);</span>
0259   set(gca,<span class="string">'fontsize'</span>,14)
0260   [legend_h,object_h,plot_h,text_str] = <a href="../AURORA/tools/legendflex.html" class="code" title="function varargout = legendflex(varargin)">legendflex</a>(phN2,N2names4l,<span class="string">'ncol'</span>,2);  
0261   set(legend_h,<span class="string">'position'</span>,get(legend_h,<span class="string">'position'</span>)+[40 20 0 0])
0262   subplot(1,3,3)
0263   phO2 = loglog(E,XsO2([1,9,8,7,6,5,4,3,2,10:15],:),<span class="string">'linewidth'</span>,2);
0264   axis([E(1) E(end) 1e-25 1e-18])
0265   axis([2.0539 8000 1e-24 3e-19])
0266   set(phO2(2),<span class="string">'linewidth'</span>,1)
0267   colormap(<a href="../AURORA/tools/py_D_cmap.html" class="code" title="function cm_data = py_D_cmap(n)">py_D_cmap</a>)
0268   set(phO2(2),<span class="string">'color'</span>,[0 0.5 0])  
0269   colormap(jet(64))
0270   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO2(3:9))
0271   set(phO2(10:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0272   cmpC = <a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>(64);
0273   colormap(cmpC(1:60,:))
0274   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO2(10:end))
0275   set(phO2(1),<span class="string">'color'</span>,<span class="string">'k'</span>)
0276   <span class="keyword">for</span> i1 = numel(phO2):-1:1
0277     O2names4l{i1} = sprintf(<span class="string">'%d'</span>,i1);
0278   <span class="keyword">end</span>
0279   legend(phO2,O2names4l)
0280   title(<span class="string">'\sigma O_2'</span>,<span class="string">'fontsize'</span>,16)
0281   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0282   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,15)
0283   set(gca,<span class="string">'fontsize'</span>,14)
0284   <span class="keyword">if</span> print_figs
0285     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'ON2O2-cross-sections-01.eps'</span>);
0286     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0287     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0288     <span class="comment">% print('-depsc2','-painters','ON2O2-cross-sections-01.eps')</span>
0289   <span class="keyword">end</span>
0290   
0291   figure <span class="comment">% N2-only</span>
0292   set(gcf,<span class="string">'position'</span>,[31, 348, 1209, 746])
0293   phN2 = loglog(E,XsN2,<span class="string">'linewidth'</span>,2);
0294   axis([E(1) E(end) 1e-25 1e-18])
0295   axis([2.0539 8000 1e-24 3e-19])
0296   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2)
0297   set(phN2(2:3:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0298   set(phN2(3:3:end),<span class="string">'linestyle'</span>,<span class="string">'-.'</span>)
0299   set(phN2(end),<span class="string">'color'</span>,<span class="string">'k'</span>)
0300   <span class="keyword">for</span> i1 = numel(phN2):-1:1
0301     N2names4l{i1} = sprintf(<span class="string">'%d'</span>,i1);
0302   <span class="keyword">end</span>
0303   <span class="comment">%legend(phN2,N2names4l)</span>
0304   <span class="comment">% legend(phN2,N2names)</span>
0305   set(phN2(1),<span class="string">'color'</span>,<span class="string">'k'</span>)
0306   set(phN2(2:12),<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,1) 
0307   <span class="comment">% colormap(summer)</span>
0308   colormap(<a href="../AURORA/tools/py_D_cmap.html" class="code" title="function cm_data = py_D_cmap(n)">py_D_cmap</a>)
0309   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(2:12))     
0310   set(phN2(end-5:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)         
0311   set(phN2(13:end-6),<span class="string">'linestyle'</span>,<span class="string">'-'</span>)  
0312   cmpC = <a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>(64);
0313   colormap(cmpC(1:60,:))
0314   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(end-5:end))
0315   colormap(jet(64))
0316   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phN2(13:end-6)) 
0317   title(<span class="string">'\sigma N_2'</span>,<span class="string">'fontsize'</span>,16)
0318   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0319   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,16)
0320   <span class="comment">%legHdl = gridLegend(phN2,2,N2names4l);</span>
0321   set(gca,<span class="string">'fontsize'</span>,14)
0322   
0323   legHdl = <a href="../AURORA/tools/gridLegend.html" class="code" title="function legend_h = gridLegend(hdl,gd,varargin)">gridLegend</a>(phN2,2,N2names);
0324   <span class="keyword">if</span> print_figs
0325     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'N2-cross-sections-01.eps'</span>);
0326     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0327     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0328     <span class="comment">% print('-depsc2','-painters','N2-cross-sections-01.eps')</span>
0329   <span class="keyword">end</span>
0330   figure <span class="comment">% O2-only</span>
0331   set(gcf,<span class="string">'position'</span>,[31, 348, 1209, 746])
0332   phO2 = loglog(E,XsO2([1,9,8,7,6,5,4,3,2,10:15],:),<span class="string">'linewidth'</span>,2);
0333   axis([E(1) E(end) 1e-25 1e-18])
0334   axis([2.0539 8000 1e-24 3e-19])
0335   set(phO2(2),<span class="string">'linewidth'</span>,1)
0336   colormap(<a href="../AURORA/tools/py_D_cmap.html" class="code" title="function cm_data = py_D_cmap(n)">py_D_cmap</a>)
0337   set(phO2(2),<span class="string">'color'</span>,[0 0.5 0])  
0338   colormap(jet(64))
0339   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO2(3:9))
0340   set(phO2(10:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)
0341   cmpC = <a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>(64);
0342   colormap(cmpC(1:60,:))
0343   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO2(10:end))
0344   set(phO2(1),<span class="string">'color'</span>,<span class="string">'k'</span>)
0345   <span class="keyword">for</span> i1 = numel(phO2):-1:1
0346     O2names4l{i1} = sprintf(<span class="string">'%d'</span>,i1);
0347   <span class="keyword">end</span>
0348   legend(phO2,O2names([1,9,8,7,6,5,4,3,2,10:15]))
0349   title(<span class="string">'\sigma O_2'</span>,<span class="string">'fontsize'</span>,16)
0350   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0351   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,15)
0352   set(gca,<span class="string">'fontsize'</span>,14)
0353 
0354   <span class="keyword">if</span> print_figs
0355     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'O2-cross-sections-01.eps'</span>);
0356     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0357     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0358     <span class="comment">% print('-depsc2','-painters','N2-cross-sections-01.eps')</span>
0359   <span class="keyword">end</span>
0360   figure <span class="comment">% O - only</span>
0361 <span class="comment">%  [~,idxOlevels] = sort(O_levels(:,1));</span>
0362 idxOlevels = 1:size(O_levels,1);
0363 <span class="comment">%   O_levels = O_levels(idxOlevels,:);</span>
0364 <span class="comment">%   Onames = Onames(idxOlevels);</span>
0365   set(gcf,<span class="string">'position'</span>,[31, 348, 1209, 746])
0366   phO = loglog(E,XsO(idxOlevels,:),<span class="string">'linewidth'</span>,2);
0367   set(gca,<span class="string">'fontsize'</span>,12)
0368   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO)
0369   title(<span class="string">'\sigma O'</span>)
0370   xlabel(<span class="string">'[eV]'</span>,<span class="string">'fontsize'</span>,16)
0371   ylabel(<span class="string">'[m^{-2}]'</span>,<span class="string">'fontsize'</span>,16)
0372   axis([E(1) E(end) 1e-25 1e-18])
0373   set(gca,<span class="string">'xtick'</span>,[1 10 100 1000 1e4])
0374   set(phO(end-3:end),<span class="string">'linestyle'</span>,<span class="string">'--'</span>)         
0375   set(phO(1:end-4),<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2)  
0376   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO(1:end-4)) 
0377   <a href="../AURORA/tools/cm_and_cb_utilities/cmlines.html" class="code" title="function [HL,CLIN] = cmlines(varargin)">cmlines</a>(phO(end-3:end)) 
0378   legHdl = <a href="../AURORA/tools/gridLegend.html" class="code" title="function legend_h = gridLegend(hdl,gd,varargin)">gridLegend</a>(phO,1,Onames(idxOlevels));
0379   <span class="keyword">if</span> print_figs
0380     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'O-cross-sections-01.eps'</span>);
0381     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0382     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0383     <span class="comment">% print('-depsc2','-painters','N2-cross-sections-01.eps')</span>
0384   <span class="keyword">end</span>
0385   
0386 <span class="keyword">end</span>
0387 <span class="comment">%% Pre-calculations of cascadning electron-spectra for ionizations</span>
0388 S2ndO = <a href="../AURORA/Data_electron/O_e_2nd_dist.html" class="code" title="function Xs = O_e_2nd_dist(Es,E0in,Eionization,s_or_c)">O_e_2nd_dist</a>(E,E(end),O_levels(<span class="keyword">end</span>,1),<span class="string">'c'</span>);
0389 S2ndO2 = <a href="../AURORA/Data_electron/O2_e_2nd_dist.html" class="code" title="function Xs = O2_e_2nd_dist(Es,E0in,Eionization,s_or_c)">O2_e_2nd_dist</a>(E,E(end),O2_levels(<span class="keyword">end</span>,1),<span class="string">'c'</span>);
0390 S2ndN2 = <a href="../AURORA/Data_electron/N2_e_2nd_dist.html" class="code" title="function Xs = N2_e_2nd_dist(Es,E0in,Eionization,s_or_c)">N2_e_2nd_dist</a>(E,E(end),N2_levels(<span class="keyword">end</span>,1),<span class="string">'c'</span>);
0391 
0392 
0393 <span class="comment">%% 10-stream mu-limits:</span>
0394 dtheta = [0 10 20 30 20 10 10 20 30 20 10];
0395 theta_lims2do = 180-cumsum(dtheta);
0396 mu_lims = cos(theta_lims2do*pi/180);
0397 plot_everyone = 0;
0398 <span class="comment">%% Calculate the beam-to-beam scattering and weigthings</span>
0399 <span class="comment">%  This can be done in the function Ie_Mstream_tz_2_aurora, as was done</span>
0400 <span class="comment">%  above where the mu_scatterings argument was set to a place-holder 1, or</span>
0401 <span class="comment">%  before as done here. This is necessary to get the proper weights for</span>
0402 <span class="comment">%  calculating the fluxes in different beams to more for example an</span>
0403 <span class="comment">%  isotropic flux</span>
0404 n_dirs = 721;
0405 <span class="keyword">try</span>
0406   load e_s_bd theta_lims
0407   <span class="keyword">if</span> isequal(theta_lims,theta_lims2do)
0408     load e_s_bd.mat Pmu2mup theta2beamW BeamW mu_lims theta_lims
0409   <span class="keyword">else</span>
0410     disp(<span class="string">'theta_lims in file e_s_bd.mat does not match theta_lims2do'</span>)
0411     disp(<span class="string">'starting calculations of angular electron scattering matrices'</span>)
0412     [Pmu2mup,theta2beamW,BeamW] = <a href="../AURORA/e_transport_Ms/e_scattering_beamdistribution.html" class="code" title="function [Pmu2mup,theta2beamW,BeamW] = e_scattering_beamdistribution(mu_lims,n_dirs)">e_scattering_beamdistribution</a>(mu_lims,n_dirs);
0413     mu_lims_done = mu_lims;
0414     theta_lims = theta_lims2do;
0415     save e_s_bd_180_170_150_120_100_90_80_60_30_10_0.mat Pmu2mup theta2beamW BeamW mu_lims_done mu_lims theta_lims
0416     disp(<span class="string">'Consider fixing the theta_lims mismatch, perhaps by copying'</span>)
0417     disp(<span class="string">'the file saved (e_s_bd_180_170_150_120_100_90_80_60_30_10_0.mat)'</span>)
0418     disp(<span class="string">'to e_s_bd.mat'</span>)
0419   <span class="keyword">end</span>
0420 <span class="keyword">catch</span>
0421   [Pmu2mup,theta2beamW,BeamW] = <a href="../AURORA/e_transport_Ms/e_scattering_beamdistribution.html" class="code" title="function [Pmu2mup,theta2beamW,BeamW] = e_scattering_beamdistribution(mu_lims,n_dirs)">e_scattering_beamdistribution</a>(mu_lims,n_dirs);
0422   mu_lims_done = mu_lims;
0423   save e_s_bd_180_170_150_120_100_90_80_60_30_10_0.mat Pmu2mup theta2beamW BeamW mu_lims_done mu_lims theta_lims
0424 <span class="keyword">end</span>
0425 mu_scatterings = {Pmu2mup,theta2beamW,BeamW};
0426 c_o_mu = <a href="../AURORA/e_transport_Ms/mu_avg.html" class="code" title="function c_o_mu = mu_avg(mu_lims)">mu_avg</a>(mu_lims);
0427 <span class="comment">% B_W is created for easify generation of functions for the</span>
0428 <span class="comment">% downward fluxes and upward flux gradients at the upper boundary,</span>
0429 <span class="comment">% i.e. the downward fluxes are the primary electron spectra, and</span>
0430 <span class="comment">% since the boundary condition for the upward fluxes are that their</span>
0431 <span class="comment">% gradient is zero it is nice to make a variable that guarantees that</span>
0432 B_W = BeamW;
0433 B_W(c_o_mu&gt;0) = 0;
0434 <span class="keyword">if</span> plot_figs
0435   figure(<span class="string">'position'</span>,[20, 495, 1220, 458])
0436   <span class="keyword">for</span> i1 = numel(BeamW):-1:1,
0437     theta_str{i1} = sprintf(<span class="string">'%3.1f^\\circ - %3.1f^\\circ'</span>,<span class="keyword">...</span>
0438                             180-180/pi*acos(mu_lims(i1)),<span class="keyword">...</span>
0439                             180-180/pi*acos(mu_lims(i1+1)));
0440   <span class="keyword">end</span>
0441   spp = [2*ones(10,1),5*ones(10,1),[1:5,(10:-1:6)]'];
0442   <span class="keyword">for</span> i1 = 1:10,
0443     subplot(spp(i1,1),spp(i1,2),spp(i1,3)) 
0444     imagesc(0:180,180:-1:0,Pmu2mup(:,:,i1)),caxis([0 1])          
0445     title(theta_str{i1},<span class="string">'fontsize'</span>,14)
0446     <span class="keyword">if</span> i1 == 8
0447       xlabel(<span class="string">'scattering-angle'</span>,<span class="string">'fontsize'</span>,14)
0448     <span class="keyword">elseif</span> i1 == 5 || i1 == 6
0449       <a href="../AURORA/tools/colorbar_labeled.html" class="code" title="function handle=colorbar_labeled(label,lg,varargin)">colorbar_labeled</a>(<span class="string">''</span>)
0450     <span class="keyword">elseif</span> i1 == 1 || i1 == 10
0451       ylabel(<span class="string">'to-angle'</span>,<span class="string">'fontsize'</span>,14)
0452     <span class="keyword">end</span>
0453     set(gca,<span class="string">'xtick'</span>,0:30:180,<span class="string">'ytick'</span>,0:30:180,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'box'</span>,<span class="string">'off'</span>)
0454   <span class="keyword">end</span>
0455   colormap(<a href="../AURORA/tools/inferno.html" class="code" title="function map = inferno(N)">inferno</a>)
0456   
0457   <span class="keyword">if</span> print_figs
0458     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'Scattering-Matrices-02.eps'</span>);
0459     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0460     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0461     <span class="comment">% print('-depsc2','-painters','Scattering-Matrices-02.eps')</span>
0462   <span class="keyword">end</span>
0463   figure
0464   imagesc(180:-1:0,1:10,theta2beamW)
0465   title(<span class="string">'Beam-weigths'</span>,<span class="string">'fontsize'</span>,15)
0466   xlabel(<span class="string">'pitch-angle (degrees)'</span>,<span class="string">'fontsize'</span>,15)
0467   ylabel(<span class="string">'pitch-angle-stream'</span>,<span class="string">'fontsize'</span>,15)
0468   colorbar
0469   <span class="keyword">if</span> print_figs
0470     filename = fullfile(<span class="string">'Figures'</span>,<span class="string">'Beam-Weights-02.eps'</span>);
0471     [status, message] = <a href="../AURORA/tools/backup1000filesversions.html" class="code" title="function [status, message] = backup1000filesversions(filename)">backup1000filesversions</a>(filename);
0472     print(<span class="string">'-depsc2'</span>,<span class="string">'-painters'</span>,filename)
0473     <span class="comment">% print('-depsc2','-painters','Beam-Weights-02.eps')</span>
0474   <span class="keyword">end</span>
0475 <span class="keyword">end</span>
0476 
0477 <span class="comment">%%</span>
0478 
0479 I_stable = 1e12;
0480 
0481 setup_completed = 1;</pre></div>
<hr><address>Generated on Mon 18-Nov-2019 14:53:30 by <strong>B.&nbsp;Gustavsson</strong> with <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>